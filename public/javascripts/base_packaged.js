(function($){$().ajaxSend(function(a,xhr,s){xhr.setRequestHeader("Accept","text/javascript, text/html, application/xml, text/xml, */*")})})(jQuery);(function($){$.fn.reset=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset()}})};$.fn.enable=function(){return this.each(function(){this.disabled=false})};$.fn.disable=function(){return this.each(function(){this.disabled=true})}})(jQuery);(function($){$.extend({fieldEvent:function(el,obs){var field=el[0]||el,e="change";if(field.type=="radio"||field.type=="checkbox"){e="click"}else{if(obs&&field.type=="text"||field.type=="textarea"){e="keyup"}}return e}});$.fn.extend({delayedObserver:function(delay,callback){var el=$(this);if(typeof window.delayedObserverStack=="undefined"){window.delayedObserverStack=[]}if(typeof window.delayedObserverCallback=="undefined"){window.delayedObserverCallback=function(stackPos){observed=window.delayedObserverStack[stackPos];if(observed.timer){clearTimeout(observed.timer)}observed.timer=setTimeout(function(){observed.timer=null;observed.callback(observed.obj,observed.obj.formVal())},observed.delay*1000);observed.oldVal=observed.obj.formVal()}}window.delayedObserverStack.push({obj:el,timer:null,delay:delay,oldVal:el.formVal(),callback:callback});var stackPos=window.delayedObserverStack.length-1;if(el[0].tagName=="FORM"){$(":input",el).each(function(){var field=$(this);field.bind($.fieldEvent(field,delay),function(){observed=window.delayedObserverStack[stackPos];if(observed.obj.formVal()==observed.obj.oldVal){return}else{window.delayedObserverCallback(stackPos)}})})}else{el.bind($.fieldEvent(el,delay),function(){observed=window.delayedObserverStack[stackPos];if(observed.obj.formVal()==observed.obj.oldVal){return}else{window.delayedObserverCallback(stackPos)}})}},formVal:function(){var el=this[0];if($.browser.msie?false:el.tagName=="FORM"){return this.serialize()}if(el.type=="checkbox"||self.type=="radio"){return this.filter("input:checked").val()||""}else{return this.val()}}})})(jQuery);(function($){$.fn.extend({visualEffect:function(o){e=o.replace(/\_(.)/g,function(m,l){return l.toUpperCase()});return eval("$(this)."+e+"()")},appear:function(speed,callback){return this.fadeIn(speed,callback)},blindDown:function(speed,callback){return this.show("blind",{direction:"vertical"},speed,callback)},blindUp:function(speed,callback){return this.hide("blind",{direction:"vertical"},speed,callback)},blindRight:function(speed,callback){return this.show("blind",{direction:"horizontal"},speed,callback)},blindLeft:function(speed,callback){this.hide("blind",{direction:"horizontal"},speed,callback);return this},dropOut:function(speed,callback){return this.hide("drop",{direction:"down"},speed,callback)},dropIn:function(speed,callback){return this.show("drop",{direction:"up"},speed,callback)},fade:function(speed,callback){return this.fadeOut(speed,callback)},fadeToggle:function(speed,callback){return this.animate({opacity:"toggle"},speed,callback)},fold:function(speed,callback){return this.hide("fold",{},speed,callback)},foldOut:function(speed,callback){return this.show("fold",{},speed,callback)},grow:function(speed,callback){return this.show("scale",{},speed,callback)},highlight:function(speed,callback){return this.show("highlight",{},speed,callback)},puff:function(speed,callback){return this.hide("puff",{},speed,callback)},pulsate:function(speed,callback){return this.show("pulsate",{},speed,callback)},shake:function(speed,callback){return this.show("shake",{},speed,callback)},shrink:function(speed,callback){return this.hide("scale",{},speed,callback)},squish:function(speed,callback){return this.hide("scale",{origin:["top","left"]},speed,callback)},slideUp:function(speed,callback){return this.hide("slide",{direction:"up"},speed,callback)},slideDown:function(speed,callback){return this.show("slide",{direction:"up"},speed,callback)},switchOff:function(speed,callback){return this.hide("clip",{},speed,callback)},switchOn:function(speed,callback){return this.show("clip",{},speed,callback)}})})(jQuery);(function($){$.fn.uploadProgress=function(options){options=$.extend({dataType:"script",interval:2000,progressBar:"",progressUrl:"/progress",start:function(){},uploading:function(){},complete:function(){},success:function(){},error:function(){},preloadImages:[],uploadProgressPath:'/javascripts/jquery.uploadProgress.js',jqueryPath:'/javascripts/jquery.js',timer:{},uuid:''},options);$(function(){for(var i=0;i<options.preloadImages.length;i++)
{options.preloadImages[i]=$("<img>").attr("src",options.preloadImages[i]);}});return this.each(function(){$(this).bind('submit',function(){uuid=options.uuid;options.start();if(old_id=="/X-Progress-ID=([^&]+)/".exec($(this).attr("action"))){var action=$(this).attr("action").replace(old_id[1],uuid);$(this).attr("action",action);}else{$(this).attr("action",jQuery(this).attr("action")+"&X-Progress-ID="+uuid);}
var checkAndStopUploadProgress=jQuery.checkAndStopUploadProgress;if(!options.timer[uuid]){options.timer[uuid]=window.setInterval(function(){checkAndStopUploadProgress(this,options);},options.interval);}});});};jQuery.checkAndStopUploadProgress=function(e,options){jQuery.ajax({type:"GET",url:options.progressUrl+"?X-Progress-ID="+options.uuid,dataType:options.dataType,success:function(data,textStatus){var upload=eval(data);if(upload.state=='uploading'){upload.percents=Math.floor((upload.received/upload.size)*1000)/10;var bar=$(options.progressBar);bar.css({width:upload.percents+'%'});options.uploading(upload);}
if(upload.state=='done'){var bar=$(options.progressBar);upload.percents=100;bar.css({width:'100%'});options.success(upload);}
if(upload.state=='error'){options.error(upload);}
if(upload.state=='done'||upload.state=='error'){window.clearInterval(options.timer[options.uuid]);options.complete(upload);}}});};})(jQuery);jQuery(function($){var isIE6=($.browser.msie&&parseInt($.browser.version.substr(0,1))<7);var body=$('body');var currentSettings;var fixFF=false;var contentElt;var contentEltLast;var modal={started:false,ready:false,dataReady:false,anim:false,loadingShown:false,transition:false,error:false,full:null,bg:null,loading:null,tmp:null,content:null,wrapper:null,closing:false,contentWrapper:null,scripts:new Array()};var resized={width:false,height:false};$.fn.nyroModal=function(settings){if(!this)
return false;return this.each(function(){if(this.nodeName.toLowerCase()=='form'){$(this).submit(function(e){if(this.enctype=='multipart/form-data'){processModal($.extend(settings,{from:this}));return true;}
e.preventDefault();processModal($.extend(settings,{from:this}));return false;});}else{$(this).click(function(e){e.preventDefault();processModal($.extend(settings,{from:this}));return false;});}});};$.fn.nyroModalManual=function(settings){if(!this.length)
processModal(settings);return this.each(function(){processModal($.extend(settings,{from:this}));});};$.nyroModalManual=function(settings){processModal(settings);};$.nyroModalSettings=function(settings,deep1,deep2){setCurrentSettings(settings,deep1,deep2);if(!deep1&&modal.started){if(modal.bg&&settings.bgColor)
currentSettings.updateBgColor(modal,currentSettings,function(){});if(modal.contentWrapper&&settings.title){title=$('h1#nyroModalTitle',modal.contentWrapper);if(title.length)
title.text(settings.title);else
modal.contentWrapper.prepend('<h1 id="nyroModalTitle">'+settings.title+'</h1>');}
if(modal.content&&(modal.dataReady&&!modal.anim&&!modal.transition)&&(settings.width||settings.height)){calculateSize(true);if(fixFF)
modal.content.css({position:''});currentSettings.resize(modal,currentSettings,function(){if(fixFF)
modal.content.css({position:'fixed'});if($.isFunction(currentSettings.endResize))
currentSettings.endResize(modal,currentSettings);});}}};$.nyroModalRemove=function(){removeModal();};$.nyroModalNext=function(){var link=getGalleryLink(1);if(link)
return link.nyroModalManual(currentSettings);return false;};$.nyroModalPrev=function(){var link=getGalleryLink(-1);if(link)
return link.nyroModalManual(currentSettings);return false;};$.fn.nyroModal.settings={debug:false,modal:false,type:'',from:'',hash:'',processHandler:null,selIndicator:'nyroModalSel',formIndicator:'nyroModal',content:null,bgColor:'#000000',ajax:{},swf:{wmode:'transparent'},width:null,height:null,minWidth:400,minHeight:300,resizable:true,autoSizable:true,padding:25,regexImg:'[^\.]\.(jpg|jpeg|png|tiff|gif|bmp)\s*$',defaultImgAlt:'Image',setWidthImgTitle:true,ltr:true,css:{bg:{zIndex:100,position:'fixed',top:0,left:0,height:'100%',width:'100%'},wrapper:{zIndex:101,position:'fixed',top:'50%',left:'50%'},wrapper2:{},content:{overflow:'auto'},loading:{zIndex:102,position:'fixed',top:'50%',left:'50%',marginTop:'-50px',marginLeft:'-50px'}},wrap:{div:'<div class="wrapper"></div>',ajax:'<div class="wrapper"></div>',form:'<div class="wrapper"></div>',formData:'<div class="wrapper"></div>',image:'<div class="wrapperImg"></div>',gallery:'<div class="wrapperImg"><a href="#" class="nyroModalPrev">Prev</a><a href="#"  class="nyroModalNext">Next</a></div>',swf:'<div class="wrapperSwf"></div>',iframe:'<div class="wrapperIframe"></div>',manual:'<div class="wrapper"></div>'},closeButton:'<a href="#" class="nyroModalClose" id="closeBut" title="close">Close</a>',title:null,titleFromIframe:true,openSelector:'.nyroModal',closeSelector:'.nyroModalClose',contentLoading:'<a href="#" class="nyroModalClose">Cancel</a>',errorClass:'error',contentError:'The requested content cannot be loaded.<br />Please try again later.<br /><a href="#" class="nyroModalClose">Close</a>',handleError:null,showBackground:showBackground,hideBackground:hideBackground,endFillContent:null,showContent:showContent,endShowContent:null,beforeHideContent:null,hideContent:hideContent,showTransition:showTransition,hideTransition:hideTransition,showLoading:showLoading,hideLoading:hideLoading,resize:resize,endResize:null,updateBgColor:updateBgColor,endRemove:null};function processModal(settings){if(modal.loadingShown||modal.transition||modal.anim)
return;debug('processModal');modal.started=true;setDefaultCurrentSettings(settings);modal.error=false;modal.closing=false;modal.dataReady=false;modal.scripts=new Array();currentSettings.type=fileType();if($.isFunction(currentSettings.processHandler))
currentSettings.processHandler(currentSettings);from=currentSettings.from;url=currentSettings.url;if(currentSettings.type=='swf'){currentSettings.resizable=false;setCurrentSettings({overflow:'hidden'},'css','content');currentSettings.content='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+currentSettings.width+'" height="'+currentSettings.height+'"><param name="movie" value="'+url+'"></param>';var tmp='';$.each(currentSettings.swf,function(name,val){currentSettings.content+='<param name="'+name+'" value="'+val+'"></param>';tmp+=' '+name+'="'+val+'"';});currentSettings.content+='<embed src="'+url+'" type="application/x-shockwave-flash" width="'+currentSettings.width+'" height="'+currentSettings.height+'"'+tmp+'></embed></object>';}
if(from){var jFrom=$(from);if(currentSettings.type=='form'){var data=$(from).serializeArray();data.push({name:currentSettings.formIndicator,value:1});if(currentSettings.selector)
data.push({name:currentSettings.selIndicator,value:currentSettings.selector.substring(1)});$.ajax($.extend({},currentSettings.ajax,{url:url,data:data,type:from.method,success:ajaxLoaded,error:loadingError}));debug('Form Ajax Load: '+jFrom.attr('action'));showModal();}else if(currentSettings.type=='formData'){initModal();jFrom.attr('target','nyroModalIframe');jFrom.attr('action',url);jFrom.prepend('<input type="hidden" name="'+currentSettings.formIndicator+'" value="1" />');if(currentSettings.selector)
jFrom.prepend('<input type="hidden" name="'+currentSettings.selIndicator+'" value="'+currentSettings.selector.substring(1)+'" />');modal.tmp.html('<iframe frameborder="0" hspace="0" name="nyroModalIframe"></iframe>');$('iframe',modal.tmp).css({width:currentSettings.width}).error(loadingError).load(formDataLoaded);debug('Form Data Load: '+jFrom.attr('action'));showModal();showContentOrLoading();}else if(currentSettings.type=='image'||currentSettings.type=='gallery'){var title=jFrom.attr('title')||currentSettings.defaultImgAlt;initModal();modal.tmp.html('<img id="nyroModalImg" />').find('img').attr('alt',title);debug('Image Load: '+url);modal.tmp.css({lineHeight:0});$('img',modal.tmp).error(loadingError).load(function(){debug('Image Loaded: '+this.src);$(this).unbind('load');var w=modal.tmp.width();var h=modal.tmp.height();modal.tmp.css({lineHeight:''});setCurrentSettings({width:w,imgWidth:w,imgHeight:h});setCurrentSettings({overflow:'hidden'},'css','content');modal.dataReady=true;if(modal.loadingShown||modal.transition)
showContentOrLoading();}).attr('src',url);showModal();}else if(currentSettings.type=='iframe'){initModal();modal.tmp.html('<iframe frameborder="0" hspace="0" src="'+url+'" name="nyroModalIframe"></iframe>');debug('Iframe Load: '+url);$('iframe',modal.tmp).eq(0).css({width:'100%',height:isDoctypeStrict()?'99%':'100%'}).load(function(e){if(currentSettings.titleFromIframe&&url.indexOf(window.location.hostname)>-1)
$.nyroModalSettings({title:$('iframe',modal.full).contents().find('title').text()});});currentSettings.autoSizable=false;modal.dataReady=true;showModal();}else if(currentSettings.type){debug('Content: '+currentSettings.type);initModal();modal.tmp.html(currentSettings.content);var w=modal.tmp.width();var h=modal.tmp.height();var div=$(currentSettings.type);if(div.length){setCurrentSettings({type:'div'});w=div.width();h=div.height();if(contentElt)
contentEltLast=contentElt;contentElt=div;modal.tmp.append(div.contents());}
setCurrentSettings({width:w});if(modal.tmp.html())
modal.dataReady=true;else
loadingError();showModal();showContentOrLoading();}else{debug('Ajax Load: '+url);setCurrentSettings({type:'ajax'});var data=currentSettings.ajax.data||{};if(currentSettings.selector){if(typeof data=="string"){data+='&'+currentSettings.selIndicator+'='+currentSettings.selector.substring(1);}else{data[currentSettings.selIndicator]=currentSettings.selector.substring(1);}}
$.ajax($.extend(true,currentSettings.ajax,{url:url,success:ajaxLoaded,error:loadingError,data:data}));showModal();}}else if(currentSettings.content){debug('Content: '+currentSettings.type);setCurrentSettings({type:'manual'});initModal();modal.tmp.html($('<div/>').html(currentSettings.content).contents());if(modal.tmp.html())
modal.dataReady=true;else
loadingError();showModal();}else{}}
function setDefaultCurrentSettings(settings){debug('setDefaultCurrentSettings');currentSettings=$.extend({},$.fn.nyroModal.settings,settings);currentSettings.selector='';currentSettings.borderW=0;currentSettings.borderH=0;currentSettings.resizable=true;setMargin();}
function setCurrentSettings(settings,deep1,deep2){if(modal.started){if(deep1&&deep2){$.extend(currentSettings[deep1][deep2],settings);}else if(deep1){$.extend(currentSettings[deep1],settings);}else{$.extend(currentSettings,settings);}}else{if(deep1&&deep2){$.extend($.fn.nyroModal.settings[deep1][deep2],settings);}else if(deep1){$.extend($.fn.nyroModal.settings[deep1],settings);}else{$.extend($.fn.nyroModal.settings,settings);}}}
function setMarginScroll(){if(isIE6){if(document.documentElement){currentSettings.marginScrollLeft=document.documentElement.scrollLeft;currentSettings.marginScrollTop=document.documentElement.scrollTop;}else{currentSettings.marginScrollLeft=document.body.scrollLeft;currentSettings.marginScrollTop=document.body.scrollTop;}}else{currentSettings.marginScrollLeft=0;currentSettings.marginScrollTop=0;}}
function setMargin(){setMarginScroll();currentSettings.marginLeft=-(currentSettings.width+currentSettings.borderW)/2+currentSettings.marginScrollLeft;currentSettings.marginTop=-(currentSettings.height+currentSettings.borderH)/2+currentSettings.marginScrollTop-20;}
function setMarginloading(){setMarginScroll();var outer=getOuter(modal.loading);currentSettings.marginTopLoading=-(modal.loading.height()+outer.h.border+outer.h.padding)/2+currentSettings.marginScrollTop;currentSettings.marginLeftLoading=-(modal.loading.width()+outer.w.border+outer.w.padding)/2+currentSettings.marginScrollLeft;}
function initModal(){debug('initModal');if(!modal.full){if(currentSettings.debug)
setCurrentSettings({color:'white'},'css','bg');var iframeHideIE='';if(isIE6){body.css({height:body.height()+'px',width:body.width()+'px',position:'static',overflow:'hidden'});$('html').css({overflow:'hidden'});setCurrentSettings({position:'absolute',height:'110%',width:'110%',top:currentSettings.marginScrollTop+'px',left:currentSettings.marginScrollLeft+'px'},'css','bg');setCurrentSettings({position:'absolute'},'css','loading');setCurrentSettings({position:'absolute'},'css','wrapper');iframeHideIE=$('<iframe id="nyroModalIframeHideIe"></iframe>').css($.extend({},currentSettings.css.bg,{opacity:0,zIndex:50,border:'none'}));}
body.append($('<div id="nyroModalFull"><div id="nyroModalBg"></div><div id="nyroModalWrapper"><div id="nyroModalContent"></div></div><div id="nyrModalTmp"></div><div id="nyroModalLoading"></div></div>').hide());modal.full=$('#nyroModalFull').show();modal.bg=$('#nyroModalBg').css($.extend({backgroundColor:currentSettings.bgColor},currentSettings.css.bg)).before(iframeHideIE);if(!currentSettings.modal)
modal.bg.click(removeModal);modal.loading=$('#nyroModalLoading').css(currentSettings.css.loading).hide();modal.contentWrapper=$('#nyroModalWrapper').css(currentSettings.css.wrapper).hide();modal.content=$('#nyroModalContent');modal.tmp=$('#nyrModalTmp').hide();if($.isFunction($.fn.mousewheel)){modal.content.mousewheel(function(e,d){var elt=modal.content.get(0);if((d>0&&elt.scrollTop==0)||(d<0&&elt.scrollHeight-elt.scrollTop==elt.clientHeight)){e.preventDefault();e.stopPropagation();}});}
$(document).keydown(keyHandler);modal.content.css({width:'auto',height:'auto'});modal.contentWrapper.css({width:'auto',height:'auto'});}}
function showModal(){debug('showModal');if(!modal.ready){initModal();modal.anim=true;currentSettings.showBackground(modal,currentSettings,endBackground);}else{modal.anim=true;modal.transition=true;currentSettings.showTransition(modal,currentSettings,function(){endHideContent();modal.anim=false;showContentOrLoading();});}}
function keyHandler(e){if(e.keyCode==27){if(!currentSettings.modal)
removeModal();}else if(currentSettings.type=='gallery'&&modal.ready&&modal.dataReady&&!modal.anim&&!modal.transition){if(e.keyCode==39||e.keyCode==40){e.preventDefault();$('.nyroModalNext',modal.content).eq(0).trigger('click');return false;}else if(e.keyCode==37||e.keyCode==38){e.preventDefault();$('.nyroModalPrev',modal.content).eq(0).trigger('click');return false;}}}
function fileType(){if(currentSettings.forceType){var tmp=currentSettings.forceType;if(!currentSettings.content)
currentSettings.from=true;currentSettings.forceType=null;return tmp;}
var from=currentSettings.from;var url;if(from&&from.nodeName){var jFrom=$(from);currentSettings.url=url=from.nodeName.toLowerCase()=='form'?jFrom.attr('action'):from.href;if(jFrom.attr('rev')=='modal')
currentSettings.modal=true;if(jFrom.attr('title'))
currentSettings.title=jFrom.attr('title');var imgType=imageType(url,from);if(imgType)
return imgType;if(from.target&&from.target.toLowerCase()=='_blank'||(from.hostname&&from.hostname.replace(/:\d*$/,'')!=window.location.hostname.replace(/:\d*$/,''))){return'iframe';}else if(from.nodeName.toLowerCase()=='form'){setCurrentSettings(extractUrlSel(url));if(jFrom.attr('enctype')=='multipart/form-data')
return'formData';return'form';}}else{url=currentSettings.url;if(!currentSettings.content)
currentSettings.from=true;if(!url)
return null;var reg1=new RegExp("^http://","g");if(url.match(reg1))
return'iframe';}
var imgType=imageType(url,from);if(imgType)
return imgType;var swf=new RegExp('[^\.]\.(swf)\s*$','i');if(swf.test(url))
return'swf';var tmp=extractUrlSel(url);setCurrentSettings(tmp);if(!tmp.url)
return tmp.selector;}
function imageType(url,from){var image=new RegExp(currentSettings.regexImg,'i');if(image.test(url)){if(from&&from.rel)
return'gallery';else
return'image';}}
function extractUrlSel(url){var ret={url:null,selector:null};if(url){var hash=getHash(url);var hashLoc=getHash(window.location.href);var curLoc=window.location.href.substring(0,window.location.href.length-hashLoc.length);var req=url.substring(0,url.length-hash.length);if(req==curLoc){ret.selector=hash;}else{ret.url=req;ret.selector=hash;}}
return ret;}
function loadingError(){debug('loadingError');modal.error=true;if(!modal.ready)
return;if($.isFunction(currentSettings.handleError))
currentSettings.handleError(modal,currentSettings);modal.loading.addClass(currentSettings.errorClass).html(currentSettings.contentError);$(currentSettings.closeSelector,modal.loading).click(removeModal);setMarginloading();modal.loading.css({marginTop:currentSettings.marginTopLoading+'px',marginLeft:currentSettings.marginLeftLoading+'px'});}
function fillContent(){debug('fillContent');if(!modal.tmp.html())
return;modal.content.html(modal.tmp.contents());modal.tmp.empty();wrapContent();if($.isFunction(currentSettings.endFillContent))
currentSettings.endFillContent(modal,currentSettings);modal.content.append(modal.scripts);var currentSettingsNew=$.extend({},currentSettings);if(resized.width)
currentSettingsNew.width=null;if(resized.height)
currentSettingsNew.height=null;$(currentSettings.closeSelector,modal.contentWrapper).click(removeModal);$(currentSettings.openSelector,modal.contentWrapper).nyroModal(currentSettingsNew);}
function wrapContent(){debug('wrapContent');var wrap=$(currentSettings.wrap[currentSettings.type]);modal.content.append(wrap.children().remove());modal.contentWrapper.wrapInner(wrap);if(currentSettings.type=='gallery'){var linkPrev=getGalleryLink(-1);if(linkPrev){$('.nyroModalPrev',modal.contentWrapper).attr('href',linkPrev.attr('href')).click(function(e){e.preventDefault();linkPrev.nyroModalManual(currentSettings);return false;});}else{$('.nyroModalPrev',modal.contentWrapper).remove();}
var linkNext=getGalleryLink(1);if(linkNext){$('.nyroModalNext',modal.contentWrapper).attr('href',linkNext.attr('href')).click(function(e){e.preventDefault();linkNext.nyroModalManual(currentSettings);return false;});}else{$('.nyroModalNext',modal.contentWrapper).remove();}}
calculateSize();}
function getGalleryLink(dir){if(currentSettings.type=='gallery'){if(!currentSettings.ltr)
dir*=-1;var gallery=$('[rel="'+currentSettings.from.rel+'"]');var currentIndex=gallery.index(currentSettings.from);var index=currentIndex+dir;if(index>=0&&index<gallery.length)
return gallery.eq(index);}
return false;}
function calculateSize(resizing){debug('calculateSize');if(!modal.wrapper)
modal.wrapper=modal.contentWrapper.children(':first');resized.width=false;resized.height=false;if(currentSettings.autoSizable&&(!currentSettings.width||!currentSettings.height)){modal.contentWrapper.css({opacity:0}).show();var tmp={width:'auto',height:'auto'};if(currentSettings.width)
tmp.width=currentSettings.width;if(currentSettings.height)
tmp.height=currentSettings.height;modal.content.css(tmp);if(!currentSettings.width){currentSettings.width=modal.content.width();resized.width=true;}
if(!currentSettings.height){currentSettings.height=modal.content.height();resized.height=true;}
modal.contentWrapper.hide().css({opacity:1});}
currentSettings.width=Math.max(currentSettings.width,currentSettings.minWidth);var outerWrapper=getOuter(modal.contentWrapper);var outerWrapper2=getOuter(modal.wrapper);var outerContent=getOuter(modal.content);var tmp={content:{width:currentSettings.width},wrapper2:{width:currentSettings.width+outerContent.w.total},wrapper:{width:currentSettings.width+outerContent.w.total+outerWrapper2.w.total}};if(currentSettings.resizable){var maxHeight=$(window).height()
-currentSettings.padding*2
-outerWrapper.h.border
-(tmp.wrapper.height-currentSettings.height);var maxWidth=$(window).width()
-currentSettings.padding*2
-outerWrapper.w.border
-(tmp.wrapper.width-currentSettings.width);if(tmp.content.height>maxHeight||tmp.content.width>maxWidth){if(currentSettings.type=='image'||currentSettings.type=='gallery'){var diffW=tmp.content.width-currentSettings.imgWidth;if(diffH<0)diffH=0;if(diffW<0)diffW=0;var calcH=maxHeight-diffH;var calcW=maxWidth-diffW;var ratio=Math.min(calcH/currentSettings.imgHeight,calcW/currentSettings.imgWidth);calcH=Math.floor(currentSettings.imgHeight*ratio);calcW=Math.floor(currentSettings.imgWidth*ratio);$('img#nyroModalImg',modal.content).css({height:calcH+'px',width:calcW+'px'});tmp.content.height=calcH+diffH;tmp.content.width=calcW+diffW;}else{tmp.content.height=Math.min(tmp.content.height,maxHeight);tmp.content.width=Math.min(tmp.content.width,maxWidth);}
tmp.wrapper2={width:tmp.content.width+outerContent.w.total,height:tmp.content.height+outerContent.h.total};tmp.wrapper={width:tmp.content.width+outerContent.w.total+outerWrapper2.w.total,height:tmp.content.height+outerContent.h.total+outerWrapper2.h.total};}}
modal.content.css($.extend({},tmp.content,currentSettings.css.content));modal.wrapper.css($.extend({},tmp.wrapper2,currentSettings.css.wrapper2));if(!resizing){modal.contentWrapper.css($.extend({},tmp.wrapper,currentSettings.css.wrapper));if(currentSettings.type=='image'||currentSettings.type=='gallery'){var title=$('img',modal.content).attr('alt');$('img',modal.content).removeAttr('alt');if(title!=currentSettings.defaultImgAlt){var divTitle=$('<div>'+title+'</div>');modal.content.append(divTitle);if(currentSettings.setWidthImgTitle){var outerDivTitle=getOuter(divTitle);divTitle.css({width:(tmp.content.width+outerContent.w.padding-outerDivTitle.w.total)+'px'});}}}
if(!currentSettings.modal)
modal.contentWrapper.prepend(currentSettings.closeButton);}
if(currentSettings.title)
modal.contentWrapper.prepend('<h1 id="nyroModalTitle">'+currentSettings.title+'</h1>');tmp.wrapper.borderW=outerWrapper.w.border;tmp.wrapper.borderH=outerWrapper.h.border;setCurrentSettings(tmp.wrapper);setMargin();}
function removeModal(e){debug('removeModal');if(e)
e.preventDefault();if(modal.full&&modal.ready){modal.ready=false;modal.anim=true;modal.closing=true;if(modal.loadingShown||modal.transition){currentSettings.hideLoading(modal,currentSettings,function(){modal.loading.hide();modal.loadingShown=false;modal.transition=false;currentSettings.hideBackground(modal,currentSettings,endRemove);});}else{if(fixFF)
modal.content.css({position:''});modal.wrapper.css({overflow:'hidden'});modal.content.css({overflow:'hidden'});if($.isFunction(currentSettings.beforeHideContent)){currentSettings.beforeHideContent(modal,currentSettings,function(){currentSettings.hideContent(modal,currentSettings,function(){endHideContent();currentSettings.hideBackground(modal,currentSettings,endRemove);});});}else{currentSettings.hideContent(modal,currentSettings,function(){endHideContent();currentSettings.hideBackground(modal,currentSettings,endRemove);});}}}
if(e)
return false;}
function showContentOrLoading(){debug('showContentOrLoading');if(modal.ready&&!modal.anim){if(modal.dataReady){if(modal.tmp.html()){modal.anim=true;if(modal.transition){fillContent();currentSettings.hideTransition(modal,currentSettings,function(){modal.loading.hide();modal.transition=false;modal.loadingShown=false;endShowContent();});}else{currentSettings.hideLoading(modal,currentSettings,function(){modal.loading.hide();modal.loadingShown=false;fillContent();setMarginloading();currentSettings.showContent(modal,$.extend({},currentSettings),endShowContent);});}}}else if(!modal.loadingShown&&!modal.transition){modal.anim=true;modal.loadingShown=true;if(modal.error)
loadingError();else
modal.loading.html(currentSettings.contentLoading);$(currentSettings.closeSelector,modal.loading).click(removeModal);setMarginloading();currentSettings.showLoading(modal,currentSettings,function(){modal.anim=false;showContentOrLoading();});}}}
function ajaxLoaded(data){debug('AjaxLoaded: '+this.url);modal.tmp.html(currentSettings.selector?filterScripts($('<div>'+data+'</div>').find(currentSettings.selector).contents()):filterScripts(data));if(modal.tmp.html()){modal.dataReady=true;showContentOrLoading();}else
loadingError();}
function formDataLoaded(){debug('formDataLoaded');var jFrom=$(currentSettings.from);jFrom.attr('action',jFrom.attr('action')+currentSettings.selector);jFrom.attr('target','');$('input[name='+currentSettings.formIndicator+']',currentSettings.from).remove();var iframe=modal.tmp.children('iframe');var iframeContent=iframe.unbind('load').contents().find(currentSettings.selector||'body').not('script[src]');iframe.attr('src','about:blank');modal.tmp.html(iframeContent.html());if(modal.tmp.html()){modal.dataReady=true;showContentOrLoading();}else
loadingError();}
function endHideContent(){debug('endHideContent');modal.anim=false;if(contentEltLast){contentEltLast.append(modal.content.contents());contentEltLast=null;}else if(contentElt){contentElt.append(modal.content.contents());contentElt=null;}
modal.content.empty();modal.contentWrapper.empty().removeAttr('style');if(modal.closing||modal.transition)
modal.contentWrapper.hide();modal.contentWrapper.css(currentSettings.css.wrapper).append(modal.content);showContentOrLoading();}
function endRemove(){debug('endRemove');$(document).unbind('keydown',keyHandler);modal.anim=false;modal.full.remove();modal.full=null;if(isIE6){body.css({height:'',width:'',position:'',overflow:''});$('html').css({overflow:''});}
if($.isFunction(currentSettings.endRemove))
currentSettings.endRemove(modal,currentSettings);}
function endBackground(){debug('endBackground');modal.ready=true;modal.anim=false;showContentOrLoading();}
function endShowContent(){debug('endShowContent');modal.anim=false;modal.contentWrapper.css({opacity:''});fixFF=$.browser.mozilla&&parseFloat($.browser.version)<1.9&&currentSettings.type!='gallery'&&currentSettings.type!='image';if(fixFF)
modal.content.css({position:'fixed'});if($.isFunction(currentSettings.endShowContent))
currentSettings.endShowContent(modal,currentSettings);if(resized.width)
setCurrentSettings({width:null});if(resized.height)
setCurrentSettings({height:null});}
function getHash(url){if(typeof url=='string'){var hashPos=url.indexOf('#');if(hashPos>-1)
return url.substring(hashPos);}
return'';}
function filterScripts(data){if(typeof data=='string')
data=data.replace(/<\/?(html|head|body)([^>]*)>/gi,'');var tmp=new Array();$.each($.clean({0:data},this.ownerDocument),function(){if($.nodeName(this,"script")){if(!this.src||$(this).attr('rel')=='forceLoad')
modal.scripts.push(this);}else
tmp.push(this);});return tmp;}
function getOuter(elm){elm=elm.get(0);var ret={h:{margin:getCurCSS(elm,'marginTop')+getCurCSS(elm,'marginBottom'),border:getCurCSS(elm,'borderTopWidth')+getCurCSS(elm,'borderBottomWidth'),padding:getCurCSS(elm,'paddingTop')+getCurCSS(elm,'paddingBottom')},w:{margin:getCurCSS(elm,'marginLeft')+getCurCSS(elm,'marginRight'),border:getCurCSS(elm,'borderLeftWidth')+getCurCSS(elm,'borderRightWidth'),padding:getCurCSS(elm,'paddingLeft')+getCurCSS(elm,'paddingRight')}};ret.h.outer=ret.h.margin+ret.h.border;ret.w.outer=ret.w.margin+ret.w.border;ret.h.inner=ret.h.padding+ret.h.border;ret.w.inner=ret.w.padding+ret.w.border;ret.h.total=ret.h.outer+ret.h.padding;ret.w.total=ret.w.outer+ret.w.padding;return ret;}
function getCurCSS(elm,name){var ret=parseInt($.curCSS(elm,name,true));if(isNaN(ret))
ret=0;return ret;}
function isDoctypeStrict(){var doctype='';if($.browser.opera){return true;}else if($.browser.msie){var re=/\s+(X?HTML)\s+([\d\.]+)\s*([^\/]+)*\//gi;var res=false;if($.browser.msie)
res=document.all[0].nodeType==8?re.test(document.all[0].nodeValue):false;if(res)
doctype=RegExp.$3;}else
doctype=document.doctype.systemId;return doctype.toLowerCase().indexOf('strict')>-1}
function debug(msg){if($.fn.nyroModal.settings.debug||currentSettings&&currentSettings.debug)
nyroModalDebug(msg,modal,currentSettings||{});}
function showBackground(elts,settings,callback){elts.bg.css({opacity:0}).fadeTo(500,0.75,callback);}
function hideBackground(elts,settings,callback){elts.bg.fadeOut(300,callback);}
function showLoading(elts,settings,callback){elts.loading.css({marginTop:settings.marginTopLoading+'px',marginLeft:settings.marginLeftLoading+'px',opacity:0}).show().animate({opacity:1},{complete:callback,duration:400});}
function hideLoading(elts,settings,callback){callback();}
function showContent(elts,settings,callback){elts.loading.css({marginTop:settings.marginTopLoading+'px',marginLeft:settings.marginLeftLoading+'px'}).show().animate({width:settings.width+'px',height:settings.height+'px',marginTop:settings.marginTop+'px',marginLeft:settings.marginLeft+'px'},{duration:350,complete:function(){elts.contentWrapper.css({width:settings.width+'px',height:settings.height+'px',marginTop:settings.marginTop+'px',marginLeft:settings.marginLeft+'px'}).show();elts.loading.fadeOut(200,callback);}});}
function hideContent(elts,settings,callback){$('div#nyroModalContent').html('');elts.contentWrapper.animate({height:'50px',width:'50px',marginTop:(-(25+settings.borderH)/2+settings.marginScrollTop)+'px',marginLeft:(-(25+settings.borderW)/2+settings.marginScrollLeft)+'px'},{duration:350,complete:function(){elts.contentWrapper.hide();callback();}});}
function showTransition(elts,settings,callback){elts.loading.css({marginTop:elts.contentWrapper.css('marginTop'),marginLeft:elts.contentWrapper.css('marginLeft'),height:elts.contentWrapper.css('height'),width:elts.contentWrapper.css('width'),opacity:0}).show().fadeTo(400,1,function(){elts.contentWrapper.hide();callback();});}
function hideTransition(elts,settings,callback){elts.contentWrapper.hide().css({width:settings.width+'px',marginLeft:settings.marginLeft+'px',height:settings.height+'px',marginTop:settings.marginTop+'px',opacity:1});elts.loading.animate({width:settings.width+'px',marginLeft:settings.marginLeft+'px',height:settings.height+'px',marginTop:settings.marginTop+'px'},{complete:function(){elts.contentWrapper.show();elts.loading.fadeOut(400,function(){elts.loading.hide();callback();});},duration:350});}
function resize(elts,settings,callback){elts.contentWrapper.animate({width:settings.width+'px',marginLeft:settings.marginLeft+'px',height:settings.height+'px',marginTop:settings.marginTop+'px'},{complete:callback,duration:400});}
function updateBgColor(elts,settings,callback){if(!$.fx.step.backgroundColor){elts.bg.css({backgroundColor:settings.bgColor});callback();}else
elts.bg.animate({backgroundColor:settings.bgColor},{complete:callback,duration:400});}
$($.fn.nyroModal.settings.openSelector).nyroModal();});function nyroModalDebug(msg,elts,settings){console.log(msg);if(elts.full)
elts.bg.prepend(msg+'<br />');}
jQuery.easing['jswing']=jQuery.easing['swing'];jQuery.extend(jQuery.easing,{def:'easeOutQuad',swing:function(x,t,b,c,d){return jQuery.easing[jQuery.easing.def](x,t,b,c,d);},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(x,t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t+b;return-c/2*((--t)*(t-2)-1)+b;},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutQuart:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b;},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b;},easeInSine:function(x,t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOutSine:function(x,t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;},easeInExpo:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b;},easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeInOutExpo:function(x,t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b;},easeInCirc:function(x,t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;},easeInElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},easeOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;},easeInOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d/2)==2)return b+c;if(!p)p=d*(.3*1.5);if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;},easeInBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;},easeOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;},easeInBounce:function(x,t,b,c,d){return c-jQuery.easing.easeOutBounce(x,d-t,0,c,d)+b;},easeOutBounce:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2)return jQuery.easing.easeInBounce(x,t*2,0,c,d)*.5+b;return jQuery.easing.easeOutBounce(x,t*2-d,0,c,d)*.5+c*.5+b;}});(function($){$.fn.lightBox=function(settings){settings=jQuery.extend({overlayBgColor:'#000',overlayOpacity:0.8,fixedNavigation:false,imageLoading:'/images/lightbox-ico-loading.gif',imageBtnPrev:'/images/lightbox-btn-prev.gif',imageBtnNext:'/images/lightbox-btn-next.gif',imageBtnClose:'/images/lightbox-btn-close.gif',imageBlank:'/images/lightbox-blank.gif',containerBorderSize:10,containerResizeSpeed:400,txtImage:'Image',txtOf:'of',keyToClose:'c',keyToPrev:'p',keyToNext:'n',imageArray:[],activeImage:0},settings);var jQueryMatchedObj=this;function _initialize(){_start(this,jQueryMatchedObj);return false;}
function _start(objClicked,jQueryMatchedObj){$('embed, object, select').css({'visibility':'hidden'});_set_interface();settings.imageArray.length=0;settings.activeImage=0;if(jQueryMatchedObj.length==1){settings.imageArray.push(new Array(objClicked.getAttribute('href'),objClicked.getAttribute('title')));}else{for(var i=0;i<jQueryMatchedObj.length;i++){settings.imageArray.push(new Array(jQueryMatchedObj[i].getAttribute('href'),jQueryMatchedObj[i].getAttribute('title')));}}
while(settings.imageArray[settings.activeImage][0]!=objClicked.getAttribute('href')){settings.activeImage++;}
_set_image_to_view();}
function _set_interface(){$('body').append('<div id="jquery-overlay"></div><div id="jquery-lightbox"><div id="lightbox-container-image-box"><div id="lightbox-container-image-data-box"><div id="lightbox-container-image-data"><div id="lightbox-image-details"><span id="lightbox-image-details-caption"></span><span id="lightbox-image-details-currentNumber"></span></div><div id="lightbox-secNav"><a href="#" id="lightbox-secNav-btnClose"><img src="'+settings.imageBtnClose+'"></a></div></div></div><div id="lightbox-container-image"><img id="lightbox-image"><div style="" id="lightbox-nav"><a href="#" id="lightbox-nav-btnPrev"></a><a href="#" id="lightbox-nav-btnNext"></a></div></div></div><div id="lightbox-loading"><a href="#" id="lightbox-loading-link"><img src="'+settings.imageLoading+'"></a></div></div>');var arrPageSizes=___getPageSize();$('#jquery-overlay').css({backgroundColor:settings.overlayBgColor,opacity:settings.overlayOpacity,width:arrPageSizes[0],height:arrPageSizes[1]}).fadeIn();$('#lightbox-container-image-box').css({backgroundColor:"none",opacity:0});var arrPageScroll=___getPageScroll();$('#jquery-lightbox').css({top:arrPageScroll[1]+(arrPageSizes[3]/2),left:arrPageScroll[0]}).show();$('#jquery-overlay,#jquery-lightbox').click(function(){_finish();});$('#lightbox-loading-link,#lightbox-secNav-btnClose').click(function(){_finish();return false;});$(window).resize(function(){var arrPageSizes=___getPageSize();$('#jquery-overlay').css({width:arrPageSizes[0],height:arrPageSizes[1]});var arrPageScroll=___getPageScroll();$('#jquery-lightbox').css({top:arrPageScroll[1]+(arrPageSizes[3]/10),left:arrPageScroll[0]});});}
function _set_image_to_view(){$('#lightbox-loading').show();if(settings.fixedNavigation){$('#lightbox-image,#lightbox-container-image-data-box,#lightbox-image-details-currentNumber').hide();}else{$('#lightbox-image,#lightbox-nav,#lightbox-nav-btnPrev,#lightbox-nav-btnNext,#lightbox-image-details-currentNumber').hide();}
var objImagePreloader=new Image();objImagePreloader.onload=function(){$('#lightbox-image').attr('src',settings.imageArray[settings.activeImage][0]);var width_ratio=parseFloat($('#lightbox-image').width())/(document.body.offsetWidth-40);var height_ratio=parseFloat($('#lightbox-image').height())/((window.innerHeight||document.documentElement.clientHeight)-50)
if(Math.max(width_ratio,height_ratio)>1){var ratio=Math.max(width_ratio,height_ratio);var width=$('#lightbox-image').width()/ratio;var height=$('#lightbox-image').height()/ratio;$('#lightbox-image').width(width);objImagePreloader.width=width;$('#lightbox-image').height(height);objImagePreloader.height=height;}
var jquery_lightbox_height=((window.innerHeight||document.documentElement.clientHeight)-30-$('#lightbox-image').height())/2;$('#jquery-lightbox').css({top:(window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop)+jquery_lightbox_height});_resize_container_image_box($('#lightbox-image').width(),$('#lightbox-image').height());objImagePreloader.onload=function(){};};objImagePreloader.src=settings.imageArray[settings.activeImage][0];};function _resize_container_image_box(intImageWidth,intImageHeight){$('#lightbox-container-image-box').css({backgroundColor:'#fff',opacity:1});var intCurrentWidth=$('#lightbox-container-image-box').width();var intCurrentHeight=$('#lightbox-container-image-box').height();var intWidth=(intImageWidth+(settings.containerBorderSize*2));var intHeight=(intImageHeight+(settings.containerBorderSize*2)+14);var intDiffW=intCurrentWidth-intWidth;var intDiffH=intCurrentHeight-intHeight;$('#lightbox-container-image-box').css({width:intWidth});$('#lightbox-container-image-box').css({height:intHeight});_show_image();if((intDiffW==0)&&(intDiffH==0)){if($.browser.msie){___pause(250);}else{___pause(100);}}
$('#lightbox-container-image-data-box').css({width:intImageWidth});$('#lightbox-nav-btnPrev,#lightbox-nav-btnNext').css({height:intImageHeight+(settings.containerBorderSize*2)});};function _show_image(){$('#lightbox-loading').hide();$('#lightbox-image').fadeIn(function(){_show_image_data();_set_navigation();});_preload_neighbor_images();};function _show_image_data(){$('#lightbox-container-image-data-box').show();$('#lightbox-image-details-caption').hide();if(settings.imageArray[settings.activeImage][1]){$('#lightbox-image-details-caption').html(settings.imageArray[settings.activeImage][1]).show();}
if(settings.imageArray.length>1){$('#lightbox-image-details-currentNumber').html(settings.txtImage+' '+(settings.activeImage+1)+' '+settings.txtOf+' '+settings.imageArray.length).show();}}
function _set_navigation(){$('#lightbox-nav').show();$('#lightbox-nav-btnPrev,#lightbox-nav-btnNext').css({'background':'transparent url('+settings.imageBlank+') no-repeat'});if(settings.activeImage!=0){if(settings.fixedNavigation){$('#lightbox-nav-btnPrev').css({'background':'url('+settings.imageBtnPrev+') left 15% no-repeat'}).unbind().bind('click',function(){settings.activeImage=settings.activeImage-1;_set_image_to_view();return false;});}else{$('#lightbox-nav-btnPrev').unbind().hover(function(){$(this).css({'background':'url('+settings.imageBtnPrev+') left 15% no-repeat'});},function(){$(this).css({'background':'transparent url('+settings.imageBlank+') no-repeat'});}).show().bind('click',function(){settings.activeImage=settings.activeImage-1;_set_image_to_view();return false;});}}
if(settings.activeImage!=(settings.imageArray.length-1)){if(settings.fixedNavigation){$('#lightbox-nav-btnNext').css({'background':'url('+settings.imageBtnNext+') right 15% no-repeat'}).unbind().bind('click',function(){settings.activeImage=settings.activeImage+1;_set_image_to_view();return false;});}else{$('#lightbox-nav-btnNext').unbind().hover(function(){$(this).css({'background':'url('+settings.imageBtnNext+') right 15% no-repeat'});},function(){$(this).css({'background':'transparent url('+settings.imageBlank+') no-repeat'});}).show().bind('click',function(){settings.activeImage=settings.activeImage+1;_set_image_to_view();return false;});}}
_enable_keyboard_navigation();}
function _enable_keyboard_navigation(){$(document).keydown(function(objEvent){_keyboard_action(objEvent);});}
function _disable_keyboard_navigation(){$(document).unbind();}
function _keyboard_action(objEvent){if(objEvent==null){keycode=event.keyCode;escapeKey=27;}else{keycode=objEvent.keyCode;escapeKey=objEvent.DOM_VK_ESCAPE;}
key=String.fromCharCode(keycode).toLowerCase();if((key==settings.keyToClose)||(key=='x')||(keycode==escapeKey)){_finish();}
if((key==settings.keyToPrev)||(keycode==37)){if(settings.activeImage!=0){settings.activeImage=settings.activeImage-1;_set_image_to_view();_disable_keyboard_navigation();}}
if((key==settings.keyToNext)||(keycode==39)){if(settings.activeImage!=(settings.imageArray.length-1)){settings.activeImage=settings.activeImage+1;_set_image_to_view();_disable_keyboard_navigation();}}}
function _preload_neighbor_images(){if((settings.imageArray.length-1)>settings.activeImage){objNext=new Image();objNext.src=settings.imageArray[settings.activeImage+1][0];}
if(settings.activeImage>0){objPrev=new Image();objPrev.src=settings.imageArray[settings.activeImage-1][0];}}
function _finish(){$('#jquery-lightbox').remove();$('#jquery-overlay').fadeOut(function(){$('#jquery-overlay').remove();});$('embed, object, select').css({'visibility':'visible'});}
function ___getPageSize(){var xScroll,yScroll;if(window.innerHeight&&window.scrollMaxY){xScroll=window.innerWidth+window.scrollMaxX;yScroll=window.innerHeight+window.scrollMaxY;}else if(document.body.scrollHeight>document.body.offsetHeight){xScroll=document.body.scrollWidth;yScroll=document.body.scrollHeight;}else{xScroll=document.body.offsetWidth;yScroll=document.body.offsetHeight;}
var windowWidth,windowHeight;if(self.innerHeight){if(document.documentElement.clientWidth){windowWidth=document.documentElement.clientWidth;}else{windowWidth=self.innerWidth;}
windowHeight=self.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){windowWidth=document.documentElement.clientWidth;windowHeight=document.documentElement.clientHeight;}else if(document.body){windowWidth=document.body.clientWidth;windowHeight=document.body.clientHeight;}
if(yScroll<windowHeight){pageHeight=windowHeight;}else{pageHeight=yScroll;}
if(xScroll<windowWidth){pageWidth=xScroll;}else{pageWidth=windowWidth;}
arrayPageSize=new Array(pageWidth,pageHeight,windowWidth,windowHeight);return arrayPageSize;};function ___getPageScroll(){var xScroll,yScroll;if(self.pageYOffset){yScroll=self.pageYOffset;xScroll=self.pageXOffset;}else if(document.documentElement&&document.documentElement.scrollTop){yScroll=document.documentElement.scrollTop;xScroll=document.documentElement.scrollLeft;}else if(document.body){yScroll=document.body.scrollTop;xScroll=document.body.scrollLeft;}
arrayPageScroll=new Array(xScroll,yScroll);return arrayPageScroll;};function ___pause(ms){var date=new Date();curDate=null;do{var curDate=new Date();}
while(curDate-date<ms);};return this.unbind('click').click(_initialize);};})(jQuery);(function(jQuery){jQuery.fn.__bind__=jQuery.fn.bind;jQuery.fn.__unbind__=jQuery.fn.unbind;jQuery.fn.__find__=jQuery.fn.find;var hotkeys={version:'0.7.9',override:/keypress|keydown|keyup/g,triggersMap:{},specialKeys:{27:'esc',9:'tab',32:'space',13:'return',8:'backspace',145:'scroll',20:'capslock',144:'numlock',19:'pause',45:'insert',36:'home',46:'del',35:'end',33:'pageup',34:'pagedown',37:'left',38:'up',39:'right',40:'down',109:'-',112:'f1',113:'f2',114:'f3',115:'f4',116:'f5',117:'f6',118:'f7',119:'f8',120:'f9',121:'f10',122:'f11',123:'f12',191:'/'},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":"\"",",":"<",".":">","/":"?","\\":"|"},newTrigger:function(type,combi,callback){var result={};result[type]={};result[type][combi]={cb:callback,disableInInput:false};return result;}};hotkeys.specialKeys=jQuery.extend(hotkeys.specialKeys,{96:'0',97:'1',98:'2',99:'3',100:'4',101:'5',102:'6',103:'7',104:'8',105:'9',106:'*',107:'+',109:'-',110:'.',111:'/'});jQuery.fn.find=function(selector){this.query=selector;return jQuery.fn.__find__.apply(this,arguments);};jQuery.fn.unbind=function(type,combi,fn){if(jQuery.isFunction(combi)){fn=combi;combi=null;}
if(combi&&typeof combi==='string'){var selectorId=((this.prevObject&&this.prevObject.query)||(this[0].id&&this[0].id)||this[0]).toString();var hkTypes=type.split(' ');for(var x=0;x<hkTypes.length;x++){delete hotkeys.triggersMap[selectorId][hkTypes[x]][combi];}}
return this.__unbind__(type,fn);};jQuery.fn.bind=function(type,data,fn){var handle=type.match(hotkeys.override);if(jQuery.isFunction(data)||!handle){return this.__bind__(type,data,fn);}
else{var result=null,pass2jq=jQuery.trim(type.replace(hotkeys.override,''));if(pass2jq){result=this.__bind__(pass2jq,data,fn);}
if(typeof data==="string"){data={'combi':data};}
if(data.combi){for(var x=0;x<handle.length;x++){var eventType=handle[x];var combi=data.combi.toLowerCase(),trigger=hotkeys.newTrigger(eventType,combi,fn),selectorId=((this.prevObject&&this.prevObject.query)||(this[0].id&&this[0].id)||this[0]).toString();trigger[eventType][combi].disableInInput=data.disableInInput;if(!hotkeys.triggersMap[selectorId]){hotkeys.triggersMap[selectorId]=trigger;}
else if(!hotkeys.triggersMap[selectorId][eventType]){hotkeys.triggersMap[selectorId][eventType]=trigger[eventType];}
var mapPoint=hotkeys.triggersMap[selectorId][eventType][combi];if(!mapPoint){hotkeys.triggersMap[selectorId][eventType][combi]=[trigger[eventType][combi]];}
else if(mapPoint.constructor!==Array){hotkeys.triggersMap[selectorId][eventType][combi]=[mapPoint];}
else{hotkeys.triggersMap[selectorId][eventType][combi][mapPoint.length]=trigger[eventType][combi];}
this.each(function(){var jqElem=jQuery(this);if(jqElem.attr('hkId')&&jqElem.attr('hkId')!==selectorId){selectorId=jqElem.attr('hkId')+";"+selectorId;}
jqElem.attr('hkId',selectorId);});result=this.__bind__(handle.join(' '),data,hotkeys.handler);}}
return result;}};hotkeys.findElement=function(elem){if(!jQuery(elem).attr('hkId')){if(jQuery.browser.opera||jQuery.browser.safari){while(!jQuery(elem).attr('hkId')&&elem.parentNode){elem=elem.parentNode;}}}
return elem;};hotkeys.handler=function(event){var target=hotkeys.findElement(event.currentTarget),jTarget=jQuery(target),ids=jTarget.attr('hkId');if(ids){ids=ids.split(';');var code=event.which,type=event.type,special=hotkeys.specialKeys[code],character=!special&&String.fromCharCode(code).toLowerCase(),shift=event.shiftKey,ctrl=event.ctrlKey,alt=event.altKey||event.originalEvent.altKey,mapPoint=null;for(var x=0;x<ids.length;x++){if(hotkeys.triggersMap[ids[x]][type]){mapPoint=hotkeys.triggersMap[ids[x]][type];break;}}
if(mapPoint){var trigger;if(!shift&&!ctrl&&!alt){trigger=mapPoint[special]||(character&&mapPoint[character]);}
else{var modif='';if(alt)modif+='alt+';if(ctrl)modif+='ctrl+';if(shift)modif+='shift+';trigger=mapPoint[modif+special];if(!trigger){if(character){trigger=mapPoint[modif+character]||mapPoint[modif+hotkeys.shiftNums[character]]||(modif==='shift+'&&mapPoint[hotkeys.shiftNums[character]]);}}}
if(trigger){var result=false;for(var x=0;x<trigger.length;x++){if(trigger[x].disableInInput){var elem=jQuery(event.target);if(jTarget.is("input")||jTarget.is("textarea")||jTarget.is("select")||elem.is("input")||elem.is("textarea")||elem.is("select")){return true;}}
result=result||trigger[x].cb.apply(this,[event]);}
return result;}}}};window.hotkeys=hotkeys;return jQuery;})(jQuery);(function($){cacheAjax={_cacheData:{get:function(key){var r=$._cacheData.data[key.toString()];return(!r||(r[1]&&(new Date()).getTime()>r[1]))?false:r[0];},add:function(key,value,timeout){timeout=timeout||$._cacheData.Timeout;timeout=timeout?((new Date()).getTime()+timeout):false;$._cacheData.data[key.toString()]=[value,timeout];},del:function(key){if(key){if(key instanceof RegExp){for(var i in $._cacheData.data){if(key.test(i)){$._cacheData.data[i]=false;}}}else{$._cacheData.data[key.toString()]=false;}}else{if($._cacheData.defaultKey instanceof Function){key=$._cacheData.defaultKey.call(this).toString();}else{key=$._cacheData.defaultKey.toString();}
$._cacheData.data[key]=false;}},data:{},Timeout:false,defaultKey:document.location.hash},cacheAjax:function(para){var opt=$.extend({type:'GET',dataType:'script'},para);var cache_key=opt.key||(opt.url+opt.data);opt.success=function(e){$._cacheData.add(cache_key,e,opt.timeout);if(opt.dataType=='script'){eval(e);}
if(para.success){para.success.call(this,e);}};if(opt.type=='GET'){var result=opt.force?false:$._cacheData.get(cache_key);if(result){if(opt.dataType=='script'){eval(result);}
if(para.success){para.success.call(this,result);}
var complete=para.complete||jQuery.ajaxSettings.complete;if(complete){complete.call(this,result);}}else{$.ajax($.extend({},opt,(opt.dataType=='script')?{dataType:'text'}:{}));}}else{$.ajax(para);}},expireCache:function(key){$._cacheData.del(key);},getCache:function(key){return $._cacheData.get(key);},addCache:function(key,value,timeout){$._cacheData.add(key,value,timeout);},setCacheTimeout:function(value){$._cacheData.Timeout=value;},setCacheDefaultKey:function(value){$._cacheData.defaultKey=value;}};$.extend(cacheAjax);$.fn.extend(cacheAjax);})(jQuery);var _js_template_cache=[];function render(name,data,fun){if(data instanceof Function){fun=data;data=false};template=document.getElementById(name).value;if(_js_template_cache[name]){fn=_js_template_cache[name];}else{fn=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push(\""+
template.replace(/[\r\t\n]/g," ").replace(/\"/g,'\\"').split("{{").join("\t").replace(/((^|}})[^\t]*)/g,"$1\r").replace(/\t=(.*?)(;+\s*)?}}/g,"\",function(){ try { return $1 }catch(err){ return '$1 undefined'} }.apply(this),\"").split("\t").join("\");").split("}}").join(";p.push(\"").split("\r").join("")
+"\");};return p.join('');");_js_template_cache[name]=fn;};result=fn.call(this,data||'');return(fun instanceof Function)?fun.call(this,result):result;};String.prototype.autolink=function(){return this.toString().replace(/((https?:\/\/|www\.)[^'"\s]*)/gi,'<a href="$1" target="_blank" class="skyLink">$1</a>');};Array.prototype.unique=function(){var r=new Array();o:for(var i=0,n=this.length;i<n;i++)
{for(var x=0,y=r.length;x<y;x++)
{if(r[x].id==this[i].id)
{continue o;}}
r[r.length]=this[i];}
return r;};var MD5=function(string){function RotateLeft(lValue,iShiftBits){return(lValue<<iShiftBits)|(lValue>>>(32-iShiftBits));}
function AddUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=(lX&0x80000000);lY8=(lY&0x80000000);lX4=(lX&0x40000000);lY4=(lY&0x40000000);lResult=(lX&0x3FFFFFFF)+(lY&0x3FFFFFFF);if(lX4&lY4){return(lResult^0x80000000^lX8^lY8);}
if(lX4|lY4){if(lResult&0x40000000){return(lResult^0xC0000000^lX8^lY8);}else{return(lResult^0x40000000^lX8^lY8);}}else{return(lResult^lX8^lY8);}}
function F(x,y,z){return(x&y)|((~x)&z);}
function G(x,y,z){return(x&z)|(y&(~z));}
function H(x,y,z){return(x^y^z);}
function I(x,y,z){return(y^(x|(~z)));}
function FF(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function GG(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function HH(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function II(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);};function ConvertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1%64))/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=(lWordArray[lWordCount]|(string.charCodeAt(lByteCount)<<lBytePosition));lByteCount++;}
lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=lWordArray[lWordCount]|(0x80<<lBytePosition);lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray;};function WordToHex(lValue){var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=(lValue>>>(lCount*8))&255;WordToHexValue_temp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);}
return WordToHexValue;};function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;};var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=Utf8Encode(string);x=ConvertToWordArray(string);a=0x67452301;b=0xEFCDAB89;c=0x98BADCFE;d=0x10325476;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,0xD76AA478);d=FF(d,a,b,c,x[k+1],S12,0xE8C7B756);c=FF(c,d,a,b,x[k+2],S13,0x242070DB);b=FF(b,c,d,a,x[k+3],S14,0xC1BDCEEE);a=FF(a,b,c,d,x[k+4],S11,0xF57C0FAF);d=FF(d,a,b,c,x[k+5],S12,0x4787C62A);c=FF(c,d,a,b,x[k+6],S13,0xA8304613);b=FF(b,c,d,a,x[k+7],S14,0xFD469501);a=FF(a,b,c,d,x[k+8],S11,0x698098D8);d=FF(d,a,b,c,x[k+9],S12,0x8B44F7AF);c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);a=FF(a,b,c,d,x[k+12],S11,0x6B901122);d=FF(d,a,b,c,x[k+13],S12,0xFD987193);c=FF(c,d,a,b,x[k+14],S13,0xA679438E);b=FF(b,c,d,a,x[k+15],S14,0x49B40821);a=GG(a,b,c,d,x[k+1],S21,0xF61E2562);d=GG(d,a,b,c,x[k+6],S22,0xC040B340);c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);b=GG(b,c,d,a,x[k+0],S24,0xE9B6C7AA);a=GG(a,b,c,d,x[k+5],S21,0xD62F105D);d=GG(d,a,b,c,x[k+10],S22,0x2441453);c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);b=GG(b,c,d,a,x[k+4],S24,0xE7D3FBC8);a=GG(a,b,c,d,x[k+9],S21,0x21E1CDE6);d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);c=GG(c,d,a,b,x[k+3],S23,0xF4D50D87);b=GG(b,c,d,a,x[k+8],S24,0x455A14ED);a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);d=GG(d,a,b,c,x[k+2],S22,0xFCEFA3F8);c=GG(c,d,a,b,x[k+7],S23,0x676F02D9);b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);a=HH(a,b,c,d,x[k+5],S31,0xFFFA3942);d=HH(d,a,b,c,x[k+8],S32,0x8771F681);c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);a=HH(a,b,c,d,x[k+1],S31,0xA4BEEA44);d=HH(d,a,b,c,x[k+4],S32,0x4BDECFA9);c=HH(c,d,a,b,x[k+7],S33,0xF6BB4B60);b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);d=HH(d,a,b,c,x[k+0],S32,0xEAA127FA);c=HH(c,d,a,b,x[k+3],S33,0xD4EF3085);b=HH(b,c,d,a,x[k+6],S34,0x4881D05);a=HH(a,b,c,d,x[k+9],S31,0xD9D4D039);d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);b=HH(b,c,d,a,x[k+2],S34,0xC4AC5665);a=II(a,b,c,d,x[k+0],S41,0xF4292244);d=II(d,a,b,c,x[k+7],S42,0x432AFF97);c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);b=II(b,c,d,a,x[k+5],S44,0xFC93A039);a=II(a,b,c,d,x[k+12],S41,0x655B59C3);d=II(d,a,b,c,x[k+3],S42,0x8F0CCC92);c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);b=II(b,c,d,a,x[k+1],S44,0x85845DD1);a=II(a,b,c,d,x[k+8],S41,0x6FA87E4F);d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);c=II(c,d,a,b,x[k+6],S43,0xA3014314);b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);a=II(a,b,c,d,x[k+4],S41,0xF7537E82);d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);c=II(c,d,a,b,x[k+2],S43,0x2AD7D2BB);b=II(b,c,d,a,x[k+9],S44,0xEB86D391);a=AddUnsigned(a,AA);b=AddUnsigned(b,BB);c=AddUnsigned(c,CC);d=AddUnsigned(d,DD);}
var temp=WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);return temp.toLowerCase();};;(function($){var PATH_REPLACER="([^\/]+)";var PATH_NAME_MATCHER=/:([\w\d]+)/g;var QUERY_STRING_MATCHER=/\?([^#]*)$/;var loggers=[];Sammy={};Sammy.VERSION='0.3.0';Sammy.addLogger=function(logger){loggers.push(logger);};Sammy.log=function(){var args=$.makeArray(arguments);args.unshift("["+Date()+"]");$.each(loggers,function(i,logger){logger.apply(Sammy,args);});};Sammy.Object=function(obj){this.extend(obj);};$.extend(Sammy.Object.prototype,{extend:function(obj){$.extend(this,obj);},clone:function(obj){if(typeof obj=='undefined')obj=this;return $.extend({},obj);},toHash:function(){var json={};this.each(function(k,v){if(!$.isFunction(v)){json[k]=v}});return json;},toHTML:function(){var display="";this.each(function(k,v){if(!$.isFunction(v)){display+="<strong>"+k+"</strong> "+v+"<br />";}});return display;},uuid:function(){if(typeof this._uuid=='undefined'||!this._uuid){this._uuid=(new Date()).getTime()+'-'+parseInt(Math.random()*1000);}
return this._uuid;},each:function(){var context,object,callback,bound_callback;context=this;if(typeof arguments[0]!='function'){object=arguments[0];callback=arguments[1];}else{object=this;callback=arguments[0];}
bound_callback=function(){return callback.apply(context,arguments);}
$.each(object,bound_callback);},keys:function(attributes_only){var keys=[];for(var property in this){if(!$.isFunction(this[property])||!attributes_only){keys.push(property);}}
return keys;},join:function(){var args=$.makeArray(arguments);var delimiter=args.shift();return args.join(delimiter);},log:function(){Sammy.log.apply(Sammy,arguments);},toString:function(include_functions){var s=[]
this.each(function(k,v){if(!$.isFunction(v)||include_functions){s.push('"'+k+'": '+v.toString());}});return"Sammy.Object: {"+s.join(',')+"}";}});Sammy.Application=function(app_function){var app=this;this.routes={};this.listeners=new Sammy.Object({});this.befores=[];this.namespace=this.uuid();this.context_prototype=function(){Sammy.EventContext.apply(this,arguments)};this.context_prototype.prototype=new Sammy.EventContext();this.each(this.ROUTE_VERBS,function(i,verb){this._defineRouteShortcut(verb);});app_function.apply(this,[this]);if(this.debug){this.bindToAllEvents(function(e,data){app.log(app.toString(),e.cleaned_type,data||{});});}};Sammy.Application.prototype=$.extend({},Sammy.Object.prototype,{ROUTE_VERBS:['get','post','put','delete'],APP_EVENTS:['run','unload','lookup-route','run-route','route-found','event-context-before','event-context-after','changed','error-404','check-form-submission','redirect'],_last_route:null,_running:false,data_store_name:'sammy-app',element_selector:'body',debug:false,silence_404:true,run_interval_every:50,toString:function(){return'Sammy.Application:'+this.element_selector;},$element:function(){return $(this.element_selector);},use:function(){var args=$.makeArray(arguments);var plugin=args.shift();args.unshift(this);plugin.apply(this,args);},route:function(verb,path,callback){var app=this;var param_names=[];if(path.constructor==String){while((path_match=PATH_NAME_MATCHER.exec(path))!=null){param_names.push(path_match[1]);}
path=new RegExp(path.replace(PATH_NAME_MATCHER,PATH_REPLACER)+"$");}
var r={verb:verb,path:path,callback:callback,param_names:param_names};if(typeof this.routes[verb]=='undefined'||this.routes[verb].length==0){this.routes[verb]=[r];}else{this.routes[verb].push(r);}
return r;},eventNamespace:function(){return[this.data_store_name,this.namespace].join('-');},bind:function(name,data,callback){var app=this;if(typeof callback=='undefined')callback=data;var listener_callback=function(){var e,context,data;e=arguments[0];data=arguments[1];if(data&&data['context']){context=data['context']
delete data['context'];}else{context=new app.context_prototype(app,'bind',e.type,data);}
e.cleaned_type=e.type.replace(app.eventNamespace(),'');callback.apply(context,[e,data]);};if(!this.listeners[name])this.listeners[name]=[];this.listeners[name].push(listener_callback);if(this.isRunning()){return this._listen(name,listener_callback);}},trigger:function(name,data){return this.$element().triggerHandler([name,this.eventNamespace()].join('.'),[data]);},refresh:function(){this.last_location=null;},before:function(callback){return this.befores.push(callback);},after:function(callback){return this.bind('event-context-after',callback);},isRunning:function(){return this._running;},helpers:function(extensions){$.extend(this.context_prototype.prototype,extensions);},run:function(start_url){if(this.isRunning())return false;var app=this;this.each(this.listeners.toHash(),function(name,callbacks){this.each(callbacks,function(i,listener_callback){this._listen(name,listener_callback);});});this.trigger('run',{start_url:start_url});this._running=true;this.$element().data(this.data_store_name,this);this.last_location=null;if(this.getLocation()==''&&typeof start_url!='undefined'){this.setLocation(start_url);}
this._checkLocation();this._interval=setInterval(function(){app._checkLocation.apply(app);},this.run_interval_every);this.bind('changed',function(){app.$element().find('form:not(.'+app.eventNamespace()+')').bind('submit',function(){return app._checkFormSubmission(this);}).addClass(app.eventNamespace());});$('body').bind('onunload',function(){app.unload();});this.trigger('changed');},unload:function(){if(!this.isRunning())return false;var app=this;this.trigger('unload');clearInterval(this._interval);this.$element().find('form').unbind('submit').removeClass(app.eventNamespace());this.$element().removeData(this.data_store_name);this.each(this.listeners.toHash(),function(name,listeners){this.each(listeners,function(i,listener_callback){this._unlisten(name,listener_callback);});});this._running=false;},bindToAllEvents:function(callback){this.each(this.APP_EVENTS,function(i,e){this.bind(e,callback);});this.each(this.listeners.keys(true),function(i,name){if(this.APP_EVENTS.indexOf(name)==-1){this.bind(name,callback);}});},routablePath:function(path){return path.replace(QUERY_STRING_MATCHER,'');},lookupRoute:function(verb,path){var routed=false;this.trigger('lookup-route',{verb:verb,path:path});if(typeof this.routes[verb]!='undefined'){this.each(this.routes[verb],function(i,route){if(this.routablePath(path).match(route.path)){routed=route;return false;}});}
return routed;},runRoute:function(verb,path,params){this.log('runRoute',[verb,path].join(' '));this.trigger('run-route',{verb:verb,path:path,params:params});if(typeof params=='undefined')params={};$.extend(params,this._parseQueryString(path));var route=this.lookupRoute(verb,path);if(route){this.trigger('route-found',{route:route});if((path_params=route.path.exec(this.routablePath(path)))!=null){path_params.shift();this.each(path_params,function(i,param){if(route.param_names[i]){params[route.param_names[i]]=param;}else{if(!params['splat'])params['splat']=[];params['splat'].push(param);}});}
var context=new this.context_prototype(this,verb,path,params);this.last_route=route;var before_value=true;var befores=this.befores.slice(0);while(befores.length>0){if(befores.shift().apply(context)===false)return false;}
context.trigger('event-context-before',{context:context});var returned=route.callback.apply(context,[context]);context.trigger('event-context-after',{context:context});return returned;}else{this.notFound(verb,path);}},getLocation:function(){var matches=window.location.toString().match(/^[^#]*(#.+)$/);if(matches){return matches[1];}else{return'';}},setLocation:function(new_location){window.location=new_location;},swap:function(content){return this.$element().html(content);},notFound:function(verb,path){this.trigger('error-404',{verb:verb,path:path});throw('404 Not Found '+verb+' '+path);},_defineRouteShortcut:function(verb){var app=this;this[verb]=function(path,callback){app.route.apply(app,[verb,path,callback]);}},_checkLocation:function(){try{var location,returned;location=this.getLocation();if(location!=this.last_location){returned=this.runRoute('get',location);}
this.last_location=location;}catch(e){this.last_location=location;if(e.toString().match(/^404/)&&this.silence_404){return returned;}else{throw(e);}}
return returned;},_checkFormSubmission:function(form){var $form,path,verb,params,returned;this.trigger('check-form-submission',{form:form});$form=$(form);path=$form.attr('action');verb=$form.attr('method').toString().toLowerCase();params={'$form':$form};$.each($form.serializeArray(),function(i,field){if(params[field.name]){if($.isArray(params[field.name])){params[field.name].push(field.value);}else{params[field.name]=[params[field.name],field.value];}}else{params[field.name]=field.value;}});try{returned=this.runRoute(verb,path,params);}catch(e){if(e.toString().match(/^404/)&&this.silence_404){return true;}else{throw(e);}}
return(typeof returned=='undefined')?false:returned;},_parseQueryString:function(path){var query={},parts,pairs,pair,i;parts=path.match(QUERY_STRING_MATCHER);if(parts){pairs=parts[1].split('&');for(i=0;i<pairs.length;i+=1){pair=pairs[i].split('=');query[pair[0]]=pair[1];}}
return query;},_listen:function(name,callback){return this.$element().bind([name,this.eventNamespace()].join('.'),callback);},_unlisten:function(name,callback){return this.$element().unbind([name,this.eventNamespace()].join('.'),callback);}});Sammy.EventContext=function(app,verb,path,params){this.app=app;this.verb=verb;this.path=path;this.params=new Sammy.Object(params);}
Sammy.EventContext.prototype=$.extend({},Sammy.Object.prototype,{$element:function(){return this.app.$element();},partial:function(path,data,callback){var file_data,wrapped_callback,engine,cache_key='partial:'+path,context=this;if((engine=path.match(/\.([^\.]+)$/))){engine=engine[1];}
if(typeof callback=='undefined'){if($.isFunction(data)){callback=data;data={};}else{callback=function(response){context.app.swap(response);}}}
data=$.extend({},data,this);wrapped_callback=function(response){if(engine&&$.isFunction(context[engine])){response=context[engine].apply(context,[response,data]);}
callback.apply(context,[response]);context.trigger('changed');};if(this.app.cache_partials&&this.cache(cache_key)){wrapped_callback.apply(context,[this.cache(cache_key)])}else{$.get(path,function(response){if(context.app.cache_partials)context.cache(cache_key,response);wrapped_callback.apply(context,[response])});}},redirect:function(){var to,args=$.makeArray(arguments);if(args.length>1){args.unshift('/');to=this.join.apply(this,args);}else{to=args[0];}
this.trigger('redirect',{to:to});this.app.last_location=this.path;return this.app.setLocation(to);},trigger:function(name,data){if(typeof data=='undefined')data={};if(!data.context)data.context=this;return this.app.trigger(name,data);},eventNamespace:function(){return this.app.eventNamespace();},notFound:function(){return this.app.notFound(this.verb,this.path);},toString:function(){return"Sammy.EventContext: "+[this.verb,this.path,this.params].join(' ');}});$.sammy=function(app_function){return new Sammy.Application(app_function);};})(jQuery);var containers={};var current_album_id=0;var current_user_id=0;var current_picture_id=0;var current_page=0;var current_comments=[];var slideshowing=false;var filter=[];var does_not_render_index_template=false;var uploading=false;var tmp_containers=[];var last_urls=[];var checkScrollIng=false;var picture_name_revisions=[];jQuery.ajaxSetup({beforeSend:function(xhr){if($('.saving_text').size()>0){$("#loading").hide();}else{$("#loading").show();}
resetPanelBox();xhr.setRequestHeader("Accept","text/javascript");},complete:function(e){try{if(document.location.hash.length===0){pageTracker._trackPageview();}else{pageTracker._trackPageview(document.location.hash.substr(1));}}catch(err){}
ajaxComplete();}});function downloadFile(url){var elemIF=document.createElement("iframe");elemIF.src=url;elemIF.style.display="none";document.body.appendChild(elemIF);}
function prefetchPicture(pic){if(!pic){return false;}
var Img=document.createElement("img");Img.src=pic.s3_url[pictureType()];Img.style.display="none";document.body.appendChild(Img);}
$.fn.ajaxRequest=function(){$(this).unbind('click').click(function(){if($(this).attr('confirm_messae')?confirm($(this).attr('confirm_messae')):($(this).attr('ajaxmethod')=='GET'?true:confirm(_('are your sure')))){$.cacheAjax({url:$(this).attr('href'),type:$(this).attr('ajaxmethod')||"PUT",dataType:'script'});}
return false;});};function changeLanguage(lang){var loc=document.location.href.replace(/http:\/\/(zh\.|ja\.)?/,'');if(lang){loc=lang+'.'+loc;}
if(lang=='en'){loc=document.location.host+document.location.pathname+"?language=en"+document.location.hash;}
document.location.href='http://'+loc;return false;}
var getOffsetAlbum=function(num){var pos=-1;for(var i in tmp_containers){if(tmp_containers[i].id==current_album_id){var pos=i;break;}}
pos=parseInt(pos,10)+num;if(pos>=tmp_containers.length){pos=pos-tmp_containers.length;}
if(pos<0){pos=pos+tmp_containers.length;}
document.location.hash=last_urls[tmp_containers[pos].id]||('#/albums/'+tmp_containers[pos].id+'/pictures');};function next_album(){getOffsetAlbum(1);}
function prev_album(){getOffsetAlbum(-1);}
function getOffsetPicture(num){num=num||1;var ps=containers[current_album_id].children;if(current_picture_id===0){return ps[0];}
for(var i in ps){if(i=='unique'){continue;}
i=parseInt(i,10);if(ps[i].id==current_picture_id){var offset=i+num;if(offset>=ps.length){offset=offset-ps.length;}
if(offset<0){offset=offset+ps.length;}
if(containers[current_album_id].children.length==offset+1){if(containers[current_album_id].last_pictures_size==100&&containers[current_album_id].pictures_size>offset+1){$.cacheAjax({url:'/albums/'+current_album_id+'/pictures?from='+containers[current_album_id].last_picture_max_id,dataType:'script'});}}
return ps[offset];}}}
function next_picture(slideshow){if(slideshowing){slideshowing=true;}
pic=getOffsetPicture(1);document.location.hash='#/albums/'+pic.album_id+"/pictures/"+pic.id;}
function prev_picture(){pic=getOffsetPicture(-1);document.location.hash='#/albums/'+pic.album_id+"/pictures/"+pic.id;}
function getCurrentPicturePosition(){if(current_picture_id===0){return 0;}
var ps=containers[current_album_id].children;for(var i in ps){if(ps[i].id==current_picture_id){return parseInt(i,10)+1;}}}
function searchPictures(key,pictures){var values=[];var regexp=new RegExp(key,'im');$.each(pictures,function(i){x=pictures[i];if(regexp.test(x.name)||regexp.test(x.uploader)||regexp.test(x.updated_at)||regexp.test(x.exif_date)){values=values.concat(x);}});return values;}
function existPicture(album_id,picture_id){var ps=containers[album_id].children;for(var i in ps){if(ps[i].id==picture_id){return true;}}
return false;}
function getPicture(album_id,picture_id){var ps=containers[album_id].children;for(var i in ps){if(ps[i].id==picture_id){return ps[i];}}}
function getPictureComments(album_id,picture_id){var cs=containers[album_id].comments;var comments=[];for(var i in cs){if(cs[i].picture_id==picture_id){comments.push(cs[i]);}}
return comments;}
function pictureType(){width=$(window).width();if(width<800){return'cover';}else if(width<1180){return'large';}else if(width<1480){return'display';}else if(width<1780){return'larger';}else{return'zoom';}}
function sortPictures(type,order){containers[current_album_id].children=containers[current_album_id].children.sort(function(a,b){if(eval("a."+type+"== b."+type)){result=a.name>b.name?1:-1;}else{result=eval("a."+type+"> b."+type)?1:-1;}
return order?(0-result):result;});$('#pictures').html('');current_page=0;return false;}
function filterPictures(value){filter[current_album_id]=value;does_not_render_index_template=true;app.refresh();}
function add_album(e){if(e){e.preventDefault();}
$.nyroModalManual({url:'/albums/new',minHeight:100,minWidth:536});return false;}
function edit_album(e){if(e){e.preventDefault();}
$.nyroModalManual({url:'/albums/'+$('#sidebar ul li.active').attr('id').slice(6)+'/edit',minHeight:100,minWidth:536});return false;}
function add_group(e){if(e){e.preventDefault();}
$.nyroModalManual({url:'/groups/new',minHeight:100,minWidth:536});return false;}
function delete_group(msg){var active=$('#sidebar ul li.active');if(active.size()>0&&confirm(msg)){$.ajax({type:'DELETE',dataType:'script',url:'/groups/'+active.attr('id').slice(6)});}
return false;}
function bind_group_drop_actions(){$("#sidebar ul li").droppable({tolerance:'pointer',over:function(event,ui){$("#sidebar ul li").css({"background":''});$(this).css({"border":"#65676d 1px dashed"});},out:function(event,ui){$("#sidebar ul li").css({"border":'none'});},drop:function(event,ui){url=(/\/groups/).test(document.location.pathname)?("/groups/join?group="+$(this).attr("id").split('_')[1]+"&user="+$($(ui.draggable).parent()).attr("id").split('_')[1]+"&current="+$("#sidebar ul li.active span.text").text()):('/albums/'+$(this).attr('id').slice(6)+"/drop_into?picture_id="+$(ui.draggable).attr("alt"));$("#sidebar ul li").css({"border":'none'});$.ajax({type:"POST",url:url,dataType:"script"});}});}
function slideShow(force){if(force){slideshowing=true;}
if(force||slideshowing){next_picture('slideshow');}}
function stopSlideShow(){slideshowing=false;$('#stopSlideShow').text(_('start SlideShow')).attr('id','startSlideShow').unbind('click').click(function(){slideShow('force');});}
function resetPanelBox(){$('.box').unbind('click').draggable('disable');$.map($('.shared_box .shared_picture_box div'),function(x){$(x).hide().prependTo('#pictures').show('blind');});if($.browser.msie){if($('.shared_box #SWFUpload_0').size()>0){$('#footer #SWFUpload_0').remove();$('#footer').append($('.shared_box #SWFUpload_0').clone());}}}
function openPanelBox(select,shared_box_content){$('.no_permissions').remove();if($('#switch_button_'+select).attr('class')=='now'){return;}
var shared_box=$('.shared_box');resetPanelBox();$.map($('.panel span'),function(x){$(x).removeClass('now');});$('#switch_button_'+select).attr('class','now');if(shared_box_content){shared_box.html(shared_box_content);}else{shared_box.html($('trash'==select?'#box_trash':'#box_download').html());}
shared_box.show();shared_box.find('.download_all,.trash_all').click(function(){if(select!='trash'||confirm(_('are your sure'))){handelPicture($(this),select);}
return false;});shared_box.find('.download_selected,.trash_selected').click(function(){handelPicture($(this),select);return false;});shared_box.find('.shared_close_button').click(function(){closePanelBox();return false;});if(select=='trash'||select=='download'){clickPictureToShareBox();}
return false;}
function clickPictureToShareBox(){if($('.shared_box .shared_picture_box').size()>0){if($.browser.msie){$('.box a').unbind('click');}
$('.box').unbind('click').click(function(){$(this).hide();if($(this).parent().attr('id')=='pictures'){$('.shared_box').find('.shared_picture_box').append($(this));}else{$('#pictures').prepend($(this));}
$(this).show('blind');return false;});}}
function handelPicture(element,select){var ids='';$.map($('.shared_box .shared_picture_box div'),function(x){ids+=$(x).attr('pictureid')+',';});if(select=='trash'){$.ajax({url:element.attr(select)||('/pictures_destroy?album_id='+current_album_id+'&ids='+ids),type:'DELETE',dataType:'script'});}else{if(!element.attr(select)&&!ids){return false;}
downloadFile(element.attr(select)||('/albums/'+current_album_id+'.zip?ids='+ids));}
return false;}
function closePanelBox(){$('.shared_box').hide();resetPanelBox();$('.shared_box').empty();$.map($('.panel span'),function(x){$(x).removeClass('now');});return false;}
function ajaxComplete(){$("#loading").hide();$('.zoompicture').lightBox();$('.add_group_button').unbind('click').click(function(){return add_group();});$('.comment_destroy,.remove_friend,.ajaxlink').ajaxRequest();$('#friends li').mouseenter(function(){$(this).find('img.remove_friend').show();}).mouseleave(function(){$(this).find('img.remove_friend').hide();});$('.add_menu_button').unbind('click').click(function(){add_album();return false;});$('.box img.thumbnail').draggable('enable').draggable({helper:'clone',appendTo:'body',zIndex:300});bind_group_drop_actions();if(slideshowing){$('#startSlideShow').attr('id','stopSlideShow').text(_('Stop SlideShow'));if($.browser.msie){window.setTimeout(slideShow,5000);}else{$('table img.picture_box').load(function(){window.setTimeout(slideShow,2000);});}
$('a').click(function(){stopSlideShow();});$('#comment_text').focus(function(){stopSlideShow();});}
$('#stopSlideShow').unbind('click').click(function(){stopSlideShow();});$('#startSlideShow').unbind('click').click(function(){slideShow('force');});$('#switch_button_sort').mouseenter(function(){$(this).addClass('now').find('.sortDropbox').show();}).mouseleave(function(){$(this).removeClass('now').find('.sortDropbox').hide();});}
function fetch_by_url(){if(current_album_id>0&&$("#the_fetch_by_url").length===0){if(containers[current_album_id].share_with_add_permission){$('.pictures').before(render('fetch_by_url_template',{album_id:current_album_id}));}else{$.notice("no permission!");}}}
function loadPicture(){pics=containers[current_album_id].children;if(!pics[0]&&!uploading){return render('new_album_helper_template',function(data){$('#pictures').html(data);});}else{$('#pictures .uploadable').remove();}
current_page++;if((current_page+1)%3===0){if(containers[current_album_id].last_pictures_size==100){$.cacheAjax({url:'/albums/'+current_album_id+'/pictures?from='+containers[current_album_id].last_picture_max_id,dataType:'script'});}}
for(i=(current_page-1)*per_page;i<current_page*per_page;i++){if(pics[i]){$('#pictures').append(render('picture_box_template',{pic:pics[i]}));}else{return false;}}
ajaxComplete();}
function checkScroll(){if((current_page===0||nearBottomOfPage())&&checkScrollIng){loadPicture();setTimeout(checkScroll,1000);}else{setTimeout(checkScroll,250);}}
function nearBottomOfPage(){return scrollDistanceFromBottom()<100;}
function scrollDistanceFromBottom(){return Math.min($('#header').height()+$('#content_box').height()+$('#footer').height(),document.body.scrollHeight,document.body.offsetHeight)-((window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop)+(window.innerHeight||document.documentElement.clientWidth));}
$(document).bind('keydown',{combi:'ctrl+shift+f',disableInInput:true},fetch_by_url);$(document).bind('keydown',{combi:'ctrl+f',disableInInput:true},fetch_by_url);$(document).bind('keydown',{combi:'ctrl+g',disableInInput:true},fetch_by_url);$(document).bind('keydown',{combi:'right',disableInInput:true},function(){next_picture();return false;});$(document).bind('keydown',{combi:'left',disableInInput:true},function(){prev_picture();return false;});$(document).bind('keydown',{combi:'h',disableInInput:true},function(){document.location.hash='#/albums/'+current_album_id;});$(document).bind('keydown',{combi:'down',disableInInput:true},function(){next_album();return false;});$(document).bind('keydown',{combi:'up',disableInInput:true},function(){prev_album();return false;});$.setCacheTimeout(18000000);function fixDocumentHash(){if(/(albums\/\d+)(\/)?$/.test(document.location.hash)){document.location.hash='#/'+RegExp.$1+'/pictures';}
if(/^#([^\/].*)$/.test(document.location.hash)){document.location.hash='#/'+RegExp.$1;}}
window.setInterval("fixDocumentHash()",500);function filterAlbums(key,type,order){if(key==$('#album_filter').attr('placeholder')){key=false;}
$('ul.sidebarList').html('');if(key){key=new RegExp(key,'im');}
tmp_containers=[];for(var i in containers){tmp_containers.push(containers[i]);}
if(type){tmp_containers=tmp_containers.sort(function(a,b){if(eval("a."+type+"== b."+type)){result=a.name>b.name?1:-1;}else{result=eval("a."+type+"> b."+type)?1:-1;}
result=(type=='name'?(0-result):result);return order?(0-result):result;});}
for(var i in tmp_containers){if(!key||key.test(tmp_containers[i].name)||key.test(tmp_containers[i].creator)){if(tmp_containers[i].id){$('ul.sidebarList').append(render('album_row_template',{album:tmp_containers[i]}));}}}}
function fixAlbumFilterBox(){if($('#album_filter').val()===''){$('#album_filter').css('color','#333');if($('#album_filter').attr('focus')!='true'){$('#album_filter').val($('#album_filter').attr('placeholder'));}}}
$(document).ready(function(){$('#album_filter').focus(function(){if($(this).val()==$(this).attr('placeholder')){$(this).css('color','#000').val('');}
$(this).attr('focus','true');}).blur(function(){$(this).attr('focus','false');});if(/album/.test(document.location.pathname)){window.setInterval(fixAlbumFilterBox,500);$('.album_filter a').click(function(){if(!$(this).hasClass('current')){$(this).attr('order',true);}
filterAlbums($('#album_filter').val(),$(this).attr('keyword'),eval($(this).attr('order')));$('.album_filter a').removeClass('current');$(this).addClass('current').attr('order',!eval($(this).attr('order')));return false;});$('#album_filter').keyup(function(){var key=$('.album_filter a.current').attr('keyword');var order=!eval($('.album_filter a.current').attr('order'));filterAlbums(this.value,key,order);});$($('.album_filter a')[0]).click();}});$(document).ready(function(){$('.privatePhotoShare a').lightBox();$('.easyUpload a').lightBox();$('.downloadSourceFile a').lightBox();$.notice=$.jGrowl;});var app=new Sammy.Application(function(){with(this){get('#/albums/:id/pictures',function(){with(this){current_album_id=params['id'];current_picture_id=0;if(does_not_render_index_template){$('#pictures').html('');$('#content .comment').remove();}else{$('#content').html(render('picture_index_template',{album:containers[current_album_id]}));}
does_not_render_index_template=false;$.cacheAjax({url:getLocation().slice(1),key:'album_'+current_album_id,dataType:'json',async:false,success:function(data){checkScrollIng=true;containers[current_album_id].last_pictures_size=data.children.length;if(data.children.length>0){containers[current_album_id].last_picture_max_id=data.children[data.children.length-1].id;};if(filter[current_album_id]){pics=searchPictures(filter[current_album_id],data.children);data=$.extend({},data,{'children':pics});};$.extend(containers[current_album_id],data);current_page=0;containers[current_album_id].children=containers[current_album_id].children.unique();containers[current_album_id].comments=containers[current_album_id].comments.unique();if(filter[current_album_id]){var keys=[];for(var i in pics){keys.push(pics[i].id);};current_comments=[];$.each(containers[current_album_id].comments,function(){if(keys.indexOf(this.picture_id)>=0){current_comments=current_comments.concat(this);}});}else{current_comments=containers[current_album_id].comments;};document.title=containers[current_album_id].name;if(current_comments.length>0)$('#content').append(render('picture_index_comments_template'));checkScroll();}});}});get('#/albums/:album_id/pictures/:id',function(){with(this){if($.browser.msie){(/#\/albums\/(\d*)\/pictures\/(\d*)/).test(document.location.hash);current_album_id=RegExp.$1;current_picture_id=RegExp.$2;}else{current_album_id=params['album_id'];current_picture_id=params['id'];};if(!getPicture(current_album_id,current_picture_id)){$.cacheAjax({url:"/albums/"+current_album_id+"/pictures/"+current_picture_id,key:"album_"+current_album_id+"/pictures/"+current_picture_id,dataType:'json',async:false,success:function(data){if(filter[current_album_id]){pics=searchPictures(filter[current_album_id],data.children);data=$.extend({},data,{'children':pics});};$.extend(containers[current_album_id],data);containers[current_album_id].children=containers[current_album_id].children.unique();containers[current_album_id].comments=containers[current_album_id].comments.unique();}});};checkScrollIng=false;pic=getPicture(current_album_id,current_picture_id);document.title=pic.name;$('#content').html(render('picture_show_template',{album:containers[current_album_id],picture:pic}));current_comments=getPictureComments(current_album_id,current_picture_id);}});before(function(){with(this){$("#loading").show();}});after(function(){with(this){window.scrollTo(0,0);$('#content').css('min-height',Math.max($('#sidebar').height(),$('#content_box').height(),$('#comments_box').height()));if(containers[current_album_id].user_id==current_user_id){$('#info_panel_button').show().unbind('click').click(edit_album);}else{$('#info_panel_button').hide();};last_urls[current_album_id]=getLocation().slice(1);if(current_comments.length>0){$.each(current_comments,function(){$('#comments').append(render('comment_box_template',{c:this}))});}
$('#sidebar li').removeClass('active');$('#sidebar .sidebar_albums_list').find("#album_"+current_album_id).addClass('active');if(current_picture_id>0||containers[current_album_id].comments.length>0){var content_box_w=document.body.offsetWidth-523;$("#content_box").width(content_box_w);$(window).resize(function(){var content_box_w=document.body.offsetWidth-523;$("#content_box").width(content_box_w);});};ajaxComplete();cur_pos=getCurrentPicturePosition();prefetchPicture(containers[current_album_id].children[cur_pos]);prefetchPicture(containers[current_album_id].children[cur_pos+1]);}});}})
$(function(){app.run();if("/albums"==document.location.pathname&&/^#?$/.test(document.location.hash)){$.cacheAjax({url:'/albums?category=recently_updated'})};});var SWFUpload;if(SWFUpload==undefined){SWFUpload=function(settings){this.initSWFUpload(settings);};}
SWFUpload.prototype.initSWFUpload=function(settings){try{this.customSettings={};this.settings=settings;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo();}catch(ex){delete SWFUpload.instances[this.movieName];throw ex;}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 2009-03-25";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.completeURL=function(url){if(typeof(url)!=="string"||url.match(/^https?:\/\//i)||url.match(/^\//)){return url;}
var currentURL=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var indexSlash=window.location.pathname.lastIndexOf("/");if(indexSlash<=0){path="/";}else{path=window.location.pathname.substr(0,indexSlash)+"/";}
return path+url;};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(settingName,defaultValue){this.settings[settingName]=(this.settings[settingName]==undefined)?defaultValue:this.settings[settingName];};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",false);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(!!this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+new Date().getTime();}
if(!this.settings.preserve_relative_urls){this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url);this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url);}
delete this.ensureDefault;};SWFUpload.prototype.loadFlash=function(){var targetElement,tempParent;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";}
targetElement=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(targetElement==undefined){throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;}
tempParent=document.createElement("div");tempParent.innerHTML=this.getFlashHTML();targetElement.parentNode.replaceChild(tempParent.firstChild,targetElement);if(window[this.movieName]==undefined){window[this.movieName]=this.getMovieElement();}};SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />','</object>'].join("");};SWFUpload.prototype.getFlashVars=function(){var paramString=this.buildParamString();var httpSuccessString=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(httpSuccessString),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(paramString),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("");};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName);}
if(this.movieElement===null){throw"Could not find Flash element";}
return this.movieElement;};SWFUpload.prototype.buildParamString=function(){var postParams=this.settings.post_params;var paramStringPairs=[];if(typeof(postParams)==="object"){for(var name in postParams){if(postParams.hasOwnProperty(name)){paramStringPairs.push(encodeURIComponent(name.toString())+"="+encodeURIComponent(postParams[name].toString()));}}}
return paramStringPairs.join("&amp;");};SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,false);var movieElement=null;movieElement=this.getMovieElement();if(movieElement&&typeof(movieElement.CallFunction)==="unknown"){for(var i in movieElement){try{if(typeof(movieElement[i])==="function"){movieElement[i]=null;}}catch(ex1){}}
try{movieElement.parentNode.removeChild(movieElement);}catch(ex){}}
window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieElement=null;this.settings=null;this.customSettings=null;this.eventQueue=null;this.movieName=null;return true;}catch(ex2){return false;}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","\t","http_success:             ",this.settings.http_success.join(", "),"\n","\t","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_placeholder:       ",(this.settings.button_placeholder?"Set":"Not Set"),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""));};SWFUpload.prototype.addSetting=function(name,value,default_value){if(value==undefined){return(this.settings[name]=default_value);}else{return(this.settings[name]=value);}};SWFUpload.prototype.getSetting=function(name){if(this.settings[name]!=undefined){return this.settings[name];}
return"";};SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement();var returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+'</invoke>');returnValue=eval(returnString);}catch(ex){throw"Call to "+functionName+" failed";}
if(returnValue!=undefined&&typeof returnValue.post==="object"){returnValue=this.unescapeFilePostParams(returnValue);}
return returnValue;};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile");};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles");};SWFUpload.prototype.startUpload=function(fileID){this.callFlash("StartUpload",[fileID]);};SWFUpload.prototype.cancelUpload=function(fileID,triggerErrorEvent){if(triggerErrorEvent!==false){triggerErrorEvent=true;}
this.callFlash("CancelUpload",[fileID,triggerErrorEvent]);};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload");};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats");};SWFUpload.prototype.setStats=function(statsObject){this.callFlash("SetStats",[statsObject]);};SWFUpload.prototype.getFile=function(fileID){if(typeof(fileID)==="number"){return this.callFlash("GetFileByIndex",[fileID]);}else{return this.callFlash("GetFile",[fileID]);}};SWFUpload.prototype.addFileParam=function(fileID,name,value){return this.callFlash("AddFileParam",[fileID,name,value]);};SWFUpload.prototype.removeFileParam=function(fileID,name){this.callFlash("RemoveFileParam",[fileID,name]);};SWFUpload.prototype.setUploadURL=function(url){this.settings.upload_url=url.toString();this.callFlash("SetUploadURL",[url]);};SWFUpload.prototype.setPostParams=function(paramsObject){this.settings.post_params=paramsObject;this.callFlash("SetPostParams",[paramsObject]);};SWFUpload.prototype.addPostParam=function(name,value){this.settings.post_params[name]=value;this.callFlash("SetPostParams",[this.settings.post_params]);};SWFUpload.prototype.removePostParam=function(name){delete this.settings.post_params[name];this.callFlash("SetPostParams",[this.settings.post_params]);};SWFUpload.prototype.setFileTypes=function(types,description){this.settings.file_types=types;this.settings.file_types_description=description;this.callFlash("SetFileTypes",[types,description]);};SWFUpload.prototype.setFileSizeLimit=function(fileSizeLimit){this.settings.file_size_limit=fileSizeLimit;this.callFlash("SetFileSizeLimit",[fileSizeLimit]);};SWFUpload.prototype.setFileUploadLimit=function(fileUploadLimit){this.settings.file_upload_limit=fileUploadLimit;this.callFlash("SetFileUploadLimit",[fileUploadLimit]);};SWFUpload.prototype.setFileQueueLimit=function(fileQueueLimit){this.settings.file_queue_limit=fileQueueLimit;this.callFlash("SetFileQueueLimit",[fileQueueLimit]);};SWFUpload.prototype.setFilePostName=function(filePostName){this.settings.file_post_name=filePostName;this.callFlash("SetFilePostName",[filePostName]);};SWFUpload.prototype.setUseQueryString=function(useQueryString){this.settings.use_query_string=useQueryString;this.callFlash("SetUseQueryString",[useQueryString]);};SWFUpload.prototype.setRequeueOnError=function(requeueOnError){this.settings.requeue_on_error=requeueOnError;this.callFlash("SetRequeueOnError",[requeueOnError]);};SWFUpload.prototype.setHTTPSuccess=function(http_status_codes){if(typeof http_status_codes==="string"){http_status_codes=http_status_codes.replace(" ","").split(",");}
this.settings.http_success=http_status_codes;this.callFlash("SetHTTPSuccess",[http_status_codes]);};SWFUpload.prototype.setAssumeSuccessTimeout=function(timeout_seconds){this.settings.assume_success_timeout=timeout_seconds;this.callFlash("SetAssumeSuccessTimeout",[timeout_seconds]);};SWFUpload.prototype.setDebugEnabled=function(debugEnabled){this.settings.debug_enabled=debugEnabled;this.callFlash("SetDebugEnabled",[debugEnabled]);};SWFUpload.prototype.setButtonImageURL=function(buttonImageURL){if(buttonImageURL==undefined){buttonImageURL="";}
this.settings.button_image_url=buttonImageURL;this.callFlash("SetButtonImageURL",[buttonImageURL]);};SWFUpload.prototype.setButtonDimensions=function(width,height){this.settings.button_width=width;this.settings.button_height=height;var movie=this.getMovieElement();if(movie!=undefined){movie.style.width=width+"px";movie.style.height=height+"px";}
this.callFlash("SetButtonDimensions",[width,height]);};SWFUpload.prototype.setButtonText=function(html){this.settings.button_text=html;this.callFlash("SetButtonText",[html]);};SWFUpload.prototype.setButtonTextPadding=function(left,top){this.settings.button_text_top_padding=top;this.settings.button_text_left_padding=left;this.callFlash("SetButtonTextPadding",[left,top]);};SWFUpload.prototype.setButtonTextStyle=function(css){this.settings.button_text_style=css;this.callFlash("SetButtonTextStyle",[css]);};SWFUpload.prototype.setButtonDisabled=function(isDisabled){this.settings.button_disabled=isDisabled;this.callFlash("SetButtonDisabled",[isDisabled]);};SWFUpload.prototype.setButtonAction=function(buttonAction){this.settings.button_action=buttonAction;this.callFlash("SetButtonAction",[buttonAction]);};SWFUpload.prototype.setButtonCursor=function(cursor){this.settings.button_cursor=cursor;this.callFlash("SetButtonCursor",[cursor]);};SWFUpload.prototype.queueEvent=function(handlerName,argumentArray){if(argumentArray==undefined){argumentArray=[];}else if(!(argumentArray instanceof Array)){argumentArray=[argumentArray];}
var self=this;if(typeof this.settings[handlerName]==="function"){this.eventQueue.push(function(){this.settings[handlerName].apply(this,argumentArray);});setTimeout(function(){self.executeNextEvent();},0);}else if(this.settings[handlerName]!==null){throw"Event handler "+handlerName+" is unknown or is not a function";}};SWFUpload.prototype.executeNextEvent=function(){var f=this.eventQueue?this.eventQueue.shift():null;if(typeof(f)==="function"){f.apply(this);}};SWFUpload.prototype.unescapeFilePostParams=function(file){var reg=/[$]([0-9a-f]{4})/i;var unescapedPost={};var uk;if(file!=undefined){for(var k in file.post){if(file.post.hasOwnProperty(k)){uk=k;var match;while((match=reg.exec(uk))!==null){uk=uk.replace(match[0],String.fromCharCode(parseInt("0x"+match[1],16)));}
unescapedPost[uk]=file.post[k];}}
file.post=unescapedPost;}
return file;};SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface");}catch(ex){return false;}};SWFUpload.prototype.flashReady=function(){var movieElement=this.getMovieElement();if(!movieElement){this.debug("Flash called back ready but the flash movie can't be found.");return;}
this.cleanUp(movieElement);this.queueEvent("swfupload_loaded_handler");};SWFUpload.prototype.cleanUp=function(movieElement){try{if(this.movieElement&&typeof(movieElement.CallFunction)==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var key in movieElement){try{if(typeof(movieElement[key])==="function"){movieElement[key]=null;}}catch(ex){}}}}catch(ex1){}
window["__flash__removeCallback"]=function(instance,name){try{if(instance){instance[name]=null;}}catch(flashEx){}};};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler");};SWFUpload.prototype.fileQueued=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("file_queued_handler",file);};SWFUpload.prototype.fileQueueError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("file_queue_error_handler",[file,errorCode,message]);};SWFUpload.prototype.fileDialogComplete=function(numFilesSelected,numFilesQueued,numFilesInQueue){this.queueEvent("file_dialog_complete_handler",[numFilesSelected,numFilesQueued,numFilesInQueue]);};SWFUpload.prototype.uploadStart=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("return_upload_start_handler",file);};SWFUpload.prototype.returnUploadStart=function(file){var returnValue;if(typeof this.settings.upload_start_handler==="function"){file=this.unescapeFilePostParams(file);returnValue=this.settings.upload_start_handler.call(this,file);}else if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function";}
if(returnValue===undefined){returnValue=true;}
returnValue=!!returnValue;this.callFlash("ReturnUploadStart",[returnValue]);};SWFUpload.prototype.uploadProgress=function(file,bytesComplete,bytesTotal){file=this.unescapeFilePostParams(file);this.queueEvent("upload_progress_handler",[file,bytesComplete,bytesTotal]);};SWFUpload.prototype.uploadError=function(file,errorCode,message){file=this.unescapeFilePostParams(file);this.queueEvent("upload_error_handler",[file,errorCode,message]);};SWFUpload.prototype.uploadSuccess=function(file,serverData,responseReceived){file=this.unescapeFilePostParams(file);this.queueEvent("upload_success_handler",[file,serverData,responseReceived]);};SWFUpload.prototype.uploadComplete=function(file){file=this.unescapeFilePostParams(file);this.queueEvent("upload_complete_handler",file);};SWFUpload.prototype.debug=function(message){this.queueEvent("debug_handler",message);};SWFUpload.prototype.debugMessage=function(message){if(this.settings.debug){var exceptionMessage,exceptionValues=[];if(typeof message==="object"&&typeof message.name==="string"&&typeof message.message==="string"){for(var key in message){if(message.hasOwnProperty(key)){exceptionValues.push(key+": "+message[key]);}}
exceptionMessage=exceptionValues.join("\n")||"";exceptionValues=exceptionMessage.split("\n");exceptionMessage="EXCEPTION: "+exceptionValues.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(exceptionMessage);}else{SWFUpload.Console.writeLine(message);}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(message){var console,documentForm;try{console=document.getElementById("SWFUpload_Console");if(!console){documentForm=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(documentForm);console=document.createElement("textarea");console.id="SWFUpload_Console";console.style.fontFamily="monospace";console.setAttribute("wrap","off");console.wrap="off";console.style.overflow="auto";console.style.width="700px";console.style.height="350px";console.style.margin="5px";documentForm.appendChild(console);}
console.value+=message+"\n";console.scrollTop=console.scrollHeight-console.clientHeight;}catch(ex){alert("Exception: "+ex.name+" Message: "+ex.message);}};var swfobject=function(){var b="undefined",Q="object",n="Shockwave Flash",p="ShockwaveFlash.ShockwaveFlash",P="application/x-shockwave-flash",m="SWFObjectExprInst",j=window,K=document,T=navigator,o=[],N=[],i=[],d=[],J,Z=null,M=null,l=null,e=false,A=false;var h=function(){var v=typeof K.getElementById!=b&&typeof K.getElementsByTagName!=b&&typeof K.createElement!=b,AC=[0,0,0],x=null;if(typeof T.plugins!=b&&typeof T.plugins[n]==Q){x=T.plugins[n].description;if(x&&!(typeof T.mimeTypes!=b&&T.mimeTypes[P]&&!T.mimeTypes[P].enabledPlugin)){x=x.replace(/^.*\s+(\S+\s+\S+$)/,"$1");AC[0]=parseInt(x.replace(/^(.*)\..*$/,"$1"),10);AC[1]=parseInt(x.replace(/^.*\.(.*)\s.*$/,"$1"),10);AC[2]=/r/.test(x)?parseInt(x.replace(/^.*r(.*)$/,"$1"),10):0}}else{if(typeof j.ActiveXObject!=b){var y=null,AB=false;try{y=new ActiveXObject(p+".7")}catch(t){try{y=new ActiveXObject(p+".6");AC=[6,0,21];y.AllowScriptAccess="always"}catch(t){if(AC[0]==6){AB=true}}if(!AB){try{y=new ActiveXObject(p)}catch(t){}}}if(!AB&&y){try{x=y.GetVariable("$version");if(x){x=x.split(" ")[1].split(",");AC=[parseInt(x[0],10),parseInt(x[1],10),parseInt(x[2],10)]}}catch(t){}}}}var AD=T.userAgent.toLowerCase(),r=T.platform.toLowerCase(),AA=/webkit/.test(AD)?parseFloat(AD.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,q=false,z=r?/win/.test(r):/win/.test(AD),w=r?/mac/.test(r):/mac/.test(AD);return{w3cdom:v,pv:AC,webkit:AA,ie:q,win:z,mac:w}}();var L=function(){if(!h.w3cdom){return}f(H);if(h.ie&&h.win){try{K.write("<script id=__ie_ondomload defer=true src=//:><\/script>");J=C("__ie_ondomload");if(J){I(J,"onreadystatechange",S)}}catch(q){}}if(h.webkit&&typeof K.readyState!=b){Z=setInterval(function(){if(/loaded|complete/.test(K.readyState)){E()}},10)}if(typeof K.addEventListener!=b){K.addEventListener("DOMContentLoaded",E,null)}R(E)}();function S(){if(J.readyState=="complete"){J.parentNode.removeChild(J);E()}}function E(){if(e){return}if(h.ie&&h.win){var v=a("span");try{var u=K.getElementsByTagName("body")[0].appendChild(v);u.parentNode.removeChild(u)}catch(w){return}}e=true;if(Z){clearInterval(Z);Z=null}var q=o.length;for(var r=0;r<q;r++){o[r]()}}function f(q){if(e){q()}else{o[o.length]=q}}function R(r){if(typeof j.addEventListener!=b){j.addEventListener("load",r,false)}else{if(typeof K.addEventListener!=b){K.addEventListener("load",r,false)}else{if(typeof j.attachEvent!=b){I(j,"onload",r)}else{if(typeof j.onload=="function"){var q=j.onload;j.onload=function(){q();r()}}else{j.onload=r}}}}}function H(){var t=N.length;for(var q=0;q<t;q++){var u=N[q].id;if(h.pv[0]>0){var r=C(u);if(r){N[q].width=r.getAttribute("width")?r.getAttribute("width"):"0";N[q].height=r.getAttribute("height")?r.getAttribute("height"):"0";if(c(N[q].swfVersion)){if(h.webkit&&h.webkit<312){Y(r)}W(u,true)}else{if(N[q].expressInstall&&!A&&c("6.0.65")&&(h.win||h.mac)){k(N[q])}else{O(r)}}}}else{W(u,true)}}}function Y(t){var q=t.getElementsByTagName(Q)[0];if(q){var w=a("embed"),y=q.attributes;if(y){var v=y.length;for(var u=0;u<v;u++){if(y[u].nodeName=="DATA"){w.setAttribute("src",y[u].nodeValue)}else{w.setAttribute(y[u].nodeName,y[u].nodeValue)}}}var x=q.childNodes;if(x){var z=x.length;for(var r=0;r<z;r++){if(x[r].nodeType==1&&x[r].nodeName=="PARAM"){w.setAttribute(x[r].getAttribute("name"),x[r].getAttribute("value"))}}}t.parentNode.replaceChild(w,t)}}function k(w){A=true;var u=C(w.id);if(u){if(w.altContentId){var y=C(w.altContentId);if(y){M=y;l=w.altContentId}}else{M=G(u)}if(!(/%$/.test(w.width))&&parseInt(w.width,10)<310){w.width="310"}if(!(/%$/.test(w.height))&&parseInt(w.height,10)<137){w.height="137"}K.title=K.title.slice(0,47)+" - Flash Player Installation";var z=h.ie&&h.win?"ActiveX":"PlugIn",q=K.title,r="MMredirectURL="+j.location+"&MMplayerType="+z+"&MMdoctitle="+q,x=w.id;if(h.ie&&h.win&&u.readyState!=4){var t=a("div");x+="SWFObjectNew";t.setAttribute("id",x);u.parentNode.insertBefore(t,u);u.style.display="none";var v=function(){u.parentNode.removeChild(u)};I(j,"onload",v)}U({data:w.expressInstall,id:m,width:w.width,height:w.height},{flashvars:r},x)}}function O(t){if(h.ie&&h.win&&t.readyState!=4){var r=a("div");t.parentNode.insertBefore(r,t);r.parentNode.replaceChild(G(t),r);t.style.display="none";var q=function(){t.parentNode.removeChild(t)};I(j,"onload",q)}else{t.parentNode.replaceChild(G(t),t)}}function G(v){var u=a("div");if(h.win&&h.ie){u.innerHTML=v.innerHTML}else{var r=v.getElementsByTagName(Q)[0];if(r){var w=r.childNodes;if(w){var q=w.length;for(var t=0;t<q;t++){if(!(w[t].nodeType==1&&w[t].nodeName=="PARAM")&&!(w[t].nodeType==8)){u.appendChild(w[t].cloneNode(true))}}}}}return u}function U(AG,AE,t){var q,v=C(t);if(v){if(typeof AG.id==b){AG.id=t}if(h.ie&&h.win){var AF="";for(var AB in AG){if(AG[AB]!=Object.prototype[AB]){if(AB.toLowerCase()=="data"){AE.movie=AG[AB]}else{if(AB.toLowerCase()=="styleclass"){AF+=' class="'+AG[AB]+'"'}else{if(AB.toLowerCase()!="classid"){AF+=" "+AB+'="'+AG[AB]+'"'}}}}}var AD="";for(var AA in AE){if(AE[AA]!=Object.prototype[AA]){AD+='<param name="'+AA+'" value="'+AE[AA]+'" />'}}v.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+AF+">"+AD+"</object>";i[i.length]=AG.id;q=C(AG.id)}else{if(h.webkit&&h.webkit<312){var AC=a("embed");AC.setAttribute("type",P);for(var z in AG){if(AG[z]!=Object.prototype[z]){if(z.toLowerCase()=="data"){AC.setAttribute("src",AG[z])}else{if(z.toLowerCase()=="styleclass"){AC.setAttribute("class",AG[z])}else{if(z.toLowerCase()!="classid"){AC.setAttribute(z,AG[z])}}}}}for(var y in AE){if(AE[y]!=Object.prototype[y]){if(y.toLowerCase()!="movie"){AC.setAttribute(y,AE[y])}}}v.parentNode.replaceChild(AC,v);q=AC}else{var u=a(Q);u.setAttribute("type",P);for(var x in AG){if(AG[x]!=Object.prototype[x]){if(x.toLowerCase()=="styleclass"){u.setAttribute("class",AG[x])}else{if(x.toLowerCase()!="classid"){u.setAttribute(x,AG[x])}}}}for(var w in AE){if(AE[w]!=Object.prototype[w]&&w.toLowerCase()!="movie"){F(u,w,AE[w])}}v.parentNode.replaceChild(u,v);q=u}}}return q}function F(t,q,r){var u=a("param");u.setAttribute("name",q);u.setAttribute("value",r);t.appendChild(u)}function X(r){var q=C(r);if(q&&(q.nodeName=="OBJECT"||q.nodeName=="EMBED")){if(h.ie&&h.win){if(q.readyState==4){B(r)}else{j.attachEvent("onload",function(){B(r)})}}else{q.parentNode.removeChild(q)}}}function B(t){var r=C(t);if(r){for(var q in r){if(typeof r[q]=="function"){r[q]=null}}r.parentNode.removeChild(r)}}function C(t){var q=null;try{q=K.getElementById(t)}catch(r){}return q}function a(q){return K.createElement(q)}function I(t,q,r){t.attachEvent(q,r);d[d.length]=[t,q,r]}function c(t){var r=h.pv,q=t.split(".");q[0]=parseInt(q[0],10);q[1]=parseInt(q[1],10)||0;q[2]=parseInt(q[2],10)||0;return(r[0]>q[0]||(r[0]==q[0]&&r[1]>q[1])||(r[0]==q[0]&&r[1]==q[1]&&r[2]>=q[2]))?true:false}function V(v,r){if(h.ie&&h.mac){return}var u=K.getElementsByTagName("head")[0],t=a("style");t.setAttribute("type","text/css");t.setAttribute("media","screen");if(!(h.ie&&h.win)&&typeof K.createTextNode!=b){t.appendChild(K.createTextNode(v+" {"+r+"}"))}u.appendChild(t);if(h.ie&&h.win&&typeof K.styleSheets!=b&&K.styleSheets.length>0){var q=K.styleSheets[K.styleSheets.length-1];if(typeof q.addRule==Q){q.addRule(v,r)}}}function W(t,q){var r=q?"visible":"hidden";if(e&&C(t)){C(t).style.visibility=r}else{V("#"+t,"visibility:"+r)}}function g(s){var r=/[\\\"<>\.;]/;var q=r.exec(s)!=null;return q?encodeURIComponent(s):s}var D=function(){if(h.ie&&h.win){window.attachEvent("onunload",function(){var w=d.length;for(var v=0;v<w;v++){d[v][0].detachEvent(d[v][1],d[v][2])}var t=i.length;for(var u=0;u<t;u++){X(i[u])}for(var r in h){h[r]=null}h=null;for(var q in swfobject){swfobject[q]=null}swfobject=null})}}();return{registerObject:function(u,q,t){if(!h.w3cdom||!u||!q){return}var r={};r.id=u;r.swfVersion=q;r.expressInstall=t?t:false;N[N.length]=r;W(u,false)},getObjectById:function(v){var q=null;if(h.w3cdom){var t=C(v);if(t){var u=t.getElementsByTagName(Q)[0];if(!u||(u&&typeof t.SetVariable!=b)){q=t}else{if(typeof u.SetVariable!=b){q=u}}}}return q},embedSWF:function(x,AE,AB,AD,q,w,r,z,AC){if(!h.w3cdom||!x||!AE||!AB||!AD||!q){return}AB+="";AD+="";if(c(q)){W(AE,false);var AA={};if(AC&&typeof AC===Q){for(var v in AC){if(AC[v]!=Object.prototype[v]){AA[v]=AC[v]}}}AA.data=x;AA.width=AB;AA.height=AD;var y={};if(z&&typeof z===Q){for(var u in z){if(z[u]!=Object.prototype[u]){y[u]=z[u]}}}if(r&&typeof r===Q){for(var t in r){if(r[t]!=Object.prototype[t]){if(typeof y.flashvars!=b){y.flashvars+="&"+t+"="+r[t]}else{y.flashvars=t+"="+r[t]}}}}f(function(){U(AA,y,AE);if(AA.id==AE){W(AE,true)}})}else{if(w&&!A&&c("6.0.65")&&(h.win||h.mac)){A=true;W(AE,false);f(function(){var AF={};AF.id=AF.altContentId=AE;AF.width=AB;AF.height=AD;AF.expressInstall=w;k(AF)})}}},getFlashPlayerVersion:function(){return{major:h.pv[0],minor:h.pv[1],release:h.pv[2]}},hasFlashPlayerVersion:c,createSWF:function(t,r,q){if(h.w3cdom){return U(t,r,q)}else{return undefined}},removeSWF:function(q){if(h.w3cdom){X(q)}},createCSS:function(r,q){if(h.w3cdom){V(r,q)}},addDomLoadEvent:f,addLoadEvent:R,getQueryParamValue:function(v){var u=K.location.search||K.location.hash;if(v==null){return g(u)}if(u){var t=u.substring(1).split("&");for(var r=0;r<t.length;r++){if(t[r].substring(0,t[r].indexOf("="))==v){return g(t[r].substring((t[r].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(A&&M){var q=C(m);if(q){q.parentNode.replaceChild(M,q);if(l){W(l,true);if(h.ie&&h.win){M.style.display="block"}}M=null;l=null;A=false}}}}}();var SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.onload=function(){};swfobject.addDomLoadEvent(function(){if(typeof(SWFUpload.onload)==="function"){SWFUpload.onload.call(window);}});SWFUpload.prototype.initSettings=(function(oldInitSettings){return function(){if(typeof(oldInitSettings)==="function"){oldInitSettings.call(this);}
this.ensureDefault=function(settingName,defaultValue){this.settings[settingName]=(this.settings[settingName]==undefined)?defaultValue:this.settings[settingName];};this.ensureDefault("minimum_flash_version","9.0.28");this.ensureDefault("swfupload_pre_load_handler",null);this.ensureDefault("swfupload_load_failed_handler",null);delete this.ensureDefault;};})(SWFUpload.prototype.initSettings);SWFUpload.prototype.loadFlash=function(oldLoadFlash){return function(){var hasFlash=swfobject.hasFlashPlayerVersion(this.settings.minimum_flash_version);if(hasFlash){this.queueEvent("swfupload_pre_load_handler");if(typeof(oldLoadFlash)==="function"){oldLoadFlash.call(this);}}else{this.queueEvent("swfupload_load_failed_handler");}};}(SWFUpload.prototype.loadFlash);SWFUpload.prototype.displayDebugInfo=function(oldDisplayDebugInfo){return function(){if(typeof(oldDisplayDebugInfo)==="function"){oldDisplayDebugInfo.call(this);}
this.debug(["SWFUpload.SWFObject Plugin settings:","\n","\t","minimum_flash_version:                      ",this.settings.minimum_flash_version,"\n","\t","swfupload_pre_load_handler assigned:     ",(typeof(this.settings.swfupload_pre_load_handler)==="function").toString(),"\n","\t","swfupload_load_failed_handler assigned:     ",(typeof(this.settings.swfupload_load_failed_handler)==="function").toString(),"\n",].join(""));};}(SWFUpload.prototype.displayDebugInfo);}
var SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.queue={};SWFUpload.prototype.initSettings=(function(oldInitSettings){return function(){if(typeof(oldInitSettings)==="function"){oldInitSettings.call(this);}
this.queueSettings={};this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0;this.queueSettings.user_upload_complete_handler=this.settings.upload_complete_handler;this.queueSettings.user_upload_start_handler=this.settings.upload_start_handler;this.settings.upload_complete_handler=SWFUpload.queue.uploadCompleteHandler;this.settings.upload_start_handler=SWFUpload.queue.uploadStartHandler;this.settings.queue_complete_handler=this.settings.queue_complete_handler||null;};})(SWFUpload.prototype.initSettings);SWFUpload.prototype.startUpload=function(fileID){this.queueSettings.queue_cancelled_flag=false;this.callFlash("StartUpload",[fileID]);};SWFUpload.prototype.cancelQueue=function(){this.queueSettings.queue_cancelled_flag=true;this.stopUpload();var stats=this.getStats();while(stats.files_queued>0){this.cancelUpload();stats=this.getStats();}};SWFUpload.queue.uploadStartHandler=function(file){var returnValue;if(typeof(this.queueSettings.user_upload_start_handler)==="function"){returnValue=this.queueSettings.user_upload_start_handler.call(this,file);}
returnValue=(returnValue===false)?false:true;this.queueSettings.queue_cancelled_flag=!returnValue;return returnValue;};SWFUpload.queue.uploadCompleteHandler=function(file){var user_upload_complete_handler=this.queueSettings.user_upload_complete_handler;var continueUpload;if(file.filestatus===SWFUpload.FILE_STATUS.COMPLETE){this.queueSettings.queue_upload_count++;}
if(typeof(user_upload_complete_handler)==="function"){continueUpload=(user_upload_complete_handler.call(this,file)===false)?false:true;}else if(file.filestatus===SWFUpload.FILE_STATUS.QUEUED){continueUpload=false;}else{continueUpload=true;}
if(continueUpload){var stats=this.getStats();if(stats.files_queued>0&&this.queueSettings.queue_cancelled_flag===false){this.startUpload();}else if(this.queueSettings.queue_cancelled_flag===false){this.queueEvent("queue_complete_handler",[this.queueSettings.queue_upload_count]);this.queueSettings.queue_upload_count=0;}else{this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0;}}};}
function FileProgress(file,targetID){this.fileProgressID=file.id;this.opacity=100;this.height=0;this.fileProgressWrapper=document.getElementById(this.fileProgressID);if(!this.fileProgressWrapper){this.fileProgressWrapper=document.createElement("div");this.fileProgressWrapper.className="progressWrapper";this.fileProgressWrapper.id=this.fileProgressID;this.fileProgressElement=document.createElement("div");this.fileProgressElement.className="progressContainer";var progressCancel=document.createElement("a");progressCancel.className="progressCancel";progressCancel.href="#";progressCancel.style.visibility="hidden";progressCancel.appendChild(document.createTextNode(" "));var progressText=document.createElement("div");progressText.className="progressName";progressText.appendChild(document.createTextNode(file.name));var progressBar=document.createElement("div");progressBar.className="progressBarInProgress";var progressStatus=document.createElement("div");progressStatus.className="progressBarStatus";progressStatus.innerHTML="&nbsp;";this.fileProgressElement.appendChild(progressCancel);this.fileProgressElement.appendChild(progressText);this.fileProgressElement.appendChild(progressStatus);this.fileProgressElement.appendChild(progressBar);this.fileProgressWrapper.appendChild(this.fileProgressElement);document.getElementById(targetID).appendChild(this.fileProgressWrapper);}else{this.fileProgressElement=this.fileProgressWrapper.firstChild;this.reset();}
this.height=this.fileProgressWrapper.offsetHeight;this.setTimer(null);}
FileProgress.prototype.setTimer=function(timer){this.fileProgressElement["FP_TIMER"]=timer;};FileProgress.prototype.getTimer=function(timer){return this.fileProgressElement["FP_TIMER"]||null;};FileProgress.prototype.reset=function(){this.fileProgressElement.className="progressContainer";this.fileProgressElement.childNodes[2].innerHTML="&nbsp;";this.fileProgressElement.childNodes[2].className="progressBarStatus";this.fileProgressElement.childNodes[3].className="progressBarInProgress";this.fileProgressElement.childNodes[3].style.width="0%";this.appear();};FileProgress.prototype.setProgress=function(percentage){this.fileProgressElement.className="progressContainer green";this.fileProgressElement.childNodes[3].className="progressBarInProgress";this.fileProgressElement.childNodes[3].style.width=percentage+"%";this.appear();};FileProgress.prototype.setComplete=function(){this.fileProgressElement.className="progressContainer blue";this.fileProgressElement.childNodes[3].className="progressBarComplete";this.fileProgressElement.childNodes[3].style.width="";var oSelf=this;this.setTimer(setTimeout(function(){oSelf.disappear();},2000));};FileProgress.prototype.setError=function(){this.fileProgressElement.className="progressContainer red";this.fileProgressElement.childNodes[3].className="progressBarError";this.fileProgressElement.childNodes[3].style.width="";var oSelf=this;this.setTimer(setTimeout(function(){oSelf.disappear();},5000));};FileProgress.prototype.setCancelled=function(){this.fileProgressElement.className="progressContainer";this.fileProgressElement.childNodes[3].className="progressBarError";this.fileProgressElement.childNodes[3].style.width="";var oSelf=this;this.setTimer(setTimeout(function(){oSelf.disappear();},2000));};FileProgress.prototype.setStatus=function(status){this.fileProgressElement.childNodes[2].innerHTML=status;};FileProgress.prototype.toggleCancel=function(show,swfUploadInstance){this.fileProgressElement.childNodes[0].style.visibility=show?"visible":"hidden";if(swfUploadInstance){var fileID=this.fileProgressID;this.fileProgressElement.childNodes[0].onclick=function(){swfUploadInstance.cancelUpload(fileID);return false;};}};FileProgress.prototype.appear=function(){if(this.getTimer()!==null){clearTimeout(this.getTimer());this.setTimer(null);}
if(this.fileProgressWrapper.filters){try{this.fileProgressWrapper.filters.item("DXImageTransform.Microsoft.Alpha").opacity=100;}catch(e){this.fileProgressWrapper.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=100)";}}else{this.fileProgressWrapper.style.opacity=1;}
this.fileProgressWrapper.style.height="";this.height=this.fileProgressWrapper.offsetHeight;this.opacity=100;this.fileProgressWrapper.style.display="";};FileProgress.prototype.disappear=function(){var reduceOpacityBy=15;var reduceHeightBy=4;var rate=30;if(this.opacity>0){this.opacity-=reduceOpacityBy;if(this.opacity<0){this.opacity=0;}
if(this.fileProgressWrapper.filters){try{this.fileProgressWrapper.filters.item("DXImageTransform.Microsoft.Alpha").opacity=this.opacity;}catch(e){this.fileProgressWrapper.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+this.opacity+")";}}else{this.fileProgressWrapper.style.opacity=this.opacity/100;}}
if(this.height>0){this.height-=reduceHeightBy;if(this.height<0){this.height=0;}
this.fileProgressWrapper.style.height=this.height+"px";}
if(this.height>0||this.opacity>0){var oSelf=this;this.setTimer(setTimeout(function(){oSelf.disappear();},rate));}else{this.fileProgressWrapper.style.display="none";this.setTimer(null);}};function swfUploadPreLoad(){var self=this;var loading=function(){if(document.getElementById("divLoadingContent")){document.getElementById("divLoadingContent").style.display="";}
var longLoad=function(){if(document.getElementById("divLoadingContent")){document.getElementById("divLoadingContent").style.display="none";}
if(document.getElementById("divLongLoading")){document.getElementById("divLongLoading").style.display="";}};this.customSettings.loadingTimeout=setTimeout(function(){longLoad.call(self);},15*1000);};this.customSettings.loadingTimeout=setTimeout(function(){loading.call(self);},1*1000);}
function swfUploadLoaded(){var self=this;clearTimeout(this.customSettings.loadingTimeout);document.getElementById("btnCancel").onclick=function(){self.cancelQueue();};}
function swfUploadLoadFailed(){clearTimeout(this.customSettings.loadingTimeout);}
function fileQueued(file){try{var progress=new FileProgress(file,this.customSettings.progressTarget);progress.setStatus(_('Upload Pending...'));progress.toggleCancel(true,this);}catch(ex){this.debug(ex);}}
function fileQueueError(file,errorCode,message){try{if(errorCode===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){alert("You have attempted to queue too many files.\n"+(message===0?"You have reached the upload limit.":"You may select "+(message>1?"up to "+message+" files.":"one file.")));return;}
var progress=new FileProgress(file,this.customSettings.progressTarget);progress.setError();progress.toggleCancel(false);switch(errorCode){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:progress.setStatus("File is too big.");this.debug("Error Code: File too big, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:progress.setStatus("Cannot upload Zero Byte files.");this.debug("Error Code: Zero byte file, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:progress.setStatus("Invalid File Type.");this.debug("Error Code: Invalid File Type, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;default:if(file!==null){progress.setStatus("Unhandled Error");}
this.debug("Error Code: "+errorCode+", File name: "+file.name+", File size: "+file.size+", Message: "+message);break;}}catch(ex){this.debug(ex);}}
function fileDialogComplete(numFilesSelected,numFilesQueued){try{if(numFilesSelected>0){document.getElementById(this.customSettings.cancelButtonId).disabled=false;}
this.startUpload();}catch(ex){this.debug(ex);}}
function uploadStart(file){try{var progress=new FileProgress(file,this.customSettings.progressTarget);progress.setStatus(_('Upload Uploading...'));progress.toggleCancel(true,this);}
catch(ex){}
return true;}
function uploadProgress(file,bytesLoaded,bytesTotal){try{var percent=Math.ceil((bytesLoaded/bytesTotal)*100);var progress=new FileProgress(file,this.customSettings.progressTarget);progress.setProgress(percent);progress.setStatus(_('Upload Uploading...'));}catch(ex){this.debug(ex);}}
function uploadSuccess(file,serverData){try{var progress=new FileProgress(file,this.customSettings.progressTarget);if($.trim(serverData.substring(0,4))==="<div"){progress.setComplete();if($('#pictures div:first').size()){$('#pictures div:first').before(serverData);}else if($('#pictures').size()){uploading=true;$('#pictures').append(serverData);}
progress.setStatus(_('Upload File')+'('+file.name+')'+_('Upload Uploaded'));$.notice(_('Upload File')+'('+file.name+')'+_('Uploaded'));$('#switch_button_download,#switch_button_invite,#switch_button_shared_people,#switch_button_slideshow,#switch_button_trash').show();$('.zoompicture').lightBox();progress.toggleCancel(false);}else{progress.setStatus("Error.");progress.toggleCancel(false);alert(serverData);}}catch(ex){this.debug(ex);}
containers[current_album_id].pictures_size=containers[current_album_id].pictures_size+1;$.expireCache('album_'+current_album_id);}
function uploadError(file,errorCode,message){try{var progress=new FileProgress(file,this.customSettings.progressTarget);progress.setError();progress.toggleCancel(false);switch(errorCode){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:if(message==403){progress.setStatus(_('Upload photo already exist'));}else{progress.setStatus("Upload Error: "+message);}
this.debug("Error Code: HTTP Error, File name: "+file.name+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:progress.setStatus("Upload Failed.");this.debug("Error Code: Upload Failed, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:progress.setStatus("Server (IO) Error");this.debug("Error Code: IO Error, File name: "+file.name+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:progress.setStatus("Security Error");this.debug("Error Code: Security Error, File name: "+file.name+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:progress.setStatus("Upload limit exceeded.");this.debug("Error Code: Upload Limit Exceeded, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:progress.setStatus("Failed Validation.  Upload skipped.");this.debug("Error Code: File Validation Failed, File name: "+file.name+", File size: "+file.size+", Message: "+message);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:if(this.getStats().files_queued===0){document.getElementById(this.customSettings.cancelButtonId).disabled=true;}
progress.setStatus("Cancelled");progress.setCancelled();break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:progress.setStatus("Stopped");break;default:progress.setStatus("Unhandled Error: "+errorCode);this.debug("Error Code: "+errorCode+", File name: "+file.name+", File size: "+file.size+", Message: "+message);break;}}catch(ex){this.debug(ex);}}
function uploadComplete(file){if(this.getStats().files_queued===0){document.getElementById(this.customSettings.cancelButtonId).disabled=true;}}
function queueComplete(numFilesUploaded){var status=document.getElementById("divStatus");status.innerHTML=numFilesUploaded+' '+((numFilesUploaded===1?_('Upload File'):_('Upload Files')))+' '+_('Uploaded');}
jQuery.fn.editInPlace=function(options){var settings={url:"",mouseover:"",mouseout:"",params:"",field_type:"text",select_options:"",textarea_cols:"25",textarea_rows:"10",bg_over:"#ffc",bg_out:"transparent",saving_text:"Saving...",saving_image:"",default_text:"(Click here to add text)",select_text:"Choose new value",value_required:null,element_id:"element_id",update_value:"update_value",original_html:"original_html",save_button:'<button class="inplace_save">Save</button>',cancel_button:'<button class="inplace_cancel">Cancel</button>',show_buttons:false,on_blur:"save",callback:null,success:null,error:function(request){$.notice("Failed to save value");}};if(options){jQuery.extend(settings,options);}
if(settings.saving_image!=""){var loading_image=new Image();loading_image.src=settings.saving_image;}
String.prototype.trim=function(){return this.replace(/^\s+/,'').replace(/\s+$/,'');};String.prototype.escape_html=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");};return this.each(function(){if(jQuery(this).html()=="")jQuery(this).html(settings.default_text);var editing=false;var original_element=jQuery(this);var click_count=0;jQuery(this).mouseover(function(){jQuery(this).css("background",settings.bg_over);eval(settings.mouseover);}).mouseout(function(){jQuery(this).css("background",settings.bg_out);eval(settings.mouseout);}).click(function(){click_count++;if(!editing)
{editing=true;var original_html=jQuery(this).html();var buttons_code=(settings.show_buttons)?settings.save_button+' '+settings.cancel_button:'';if(original_html==settings.default_text)jQuery(this).html('');if(settings.field_type=="textarea")
{var use_field_type='<textarea name="inplace_value" class="inplace_field" rows="'+settings.textarea_rows+'" cols="'+settings.textarea_cols+'">'+(jQuery(this).attr('raw_value')||jQuery(this).text()).trim().escape_html()+'</textarea>';}
else if(settings.field_type=="text")
{var use_field_type='<input type="text" name="inplace_value" class="inplace_field" value="'+
jQuery(this).text().trim().escape_html()+'" />';}
else if(settings.field_type=="select")
{var optionsArray=settings.select_options.split(',');var use_field_type='<select name="inplace_value" class="inplace_field"><option value="">'+settings.select_text+'</option>';for(var i=0;i<optionsArray.length;i++){var optionsValuesArray=optionsArray[i].split(':');var use_value=optionsValuesArray[1]||optionsValuesArray[0];var selected=use_value==original_html?'selected="selected" ':'';use_field_type+='<option '+selected+'value="'+use_value.trim().escape_html()+'">'+optionsValuesArray[0].trim().escape_html()+'</option>';}
use_field_type+='</select>';}
jQuery(this).html('<form class="inplace_form" style="display: inline; margin: 0; padding: 0;">'+use_field_type+' '+buttons_code+'</form>');}
if(click_count==1)
{function cancelAction()
{editing=false;click_count=0;original_element.css("background",settings.bg_out);original_element.html(original_html);return false;}
function saveAction()
{original_element.css("background",settings.bg_out);var this_elem=jQuery(this);var new_html=(this_elem.is('form'))?this_elem.children(0).val():this_elem.parent().children(0).val();if(settings.saving_image!=""){var saving_message='<img src="'+settings.saving_image+'" alt="Saving..." />';}else{var saving_message=settings.saving_text;}
original_element.html(saving_message);if(settings.params!=""){settings.params="&"+settings.params;}
if(settings.callback){html=settings.callback(original_element.attr("id"),new_html,original_html,settings.params);editing=false;click_count=0;if(html){original_element.html(html||new_html);}else{alert("Failed to save value: "+new_html);original_element.html(original_html);}}else if(settings.value_required&&(new_html==""||new_html==undefined)){editing=false;click_count=0;original_element.html(original_html);alert("Error: You must enter a value to save this field");}else{jQuery.ajax({url:settings.url,type:"POST",data:settings.update_value+'='+new_html.replace(/&/,escape('&'))+'&'+settings.element_id+'='+original_element.attr("id")+settings.params+'&'+settings.original_html+'='+original_html.replace(/&/,escape('&')),dataType:"html",complete:function(request){editing=false;click_count=0;},success:function(html){var new_text=html||settings.default_text;picture_name_revisions[current_picture_id]=html;original_element.html(new_text);if(settings.success)settings.success(html,original_element);},error:function(request){original_element.html(original_html);if(settings.error)settings.error(request,original_element);}});}
return false;}
original_element.children("form").children(".inplace_field").focus().select();original_element.children("form").children(".inplace_cancel").click(cancelAction);original_element.children("form").children(".inplace_save").click(saveAction);if(!settings.show_buttons){if(settings.on_blur=="save")
original_element.children("form").children(".inplace_field").blur(saveAction);else
original_element.children("form").children(".inplace_field").blur(cancelAction);}
$(document).keyup(function(event){if(event.keyCode==27){cancelAction();}});original_element.children("form").submit(saveAction);}});});};function updateBirthday(){if(parseBirthday()=='')return;if($('#div_profile_birthday').css('display')=='none'){$('#div_profile_birthday').show();}}
function updateGender(){var gender=getValFromSelect("#profile_gender");if(gender=='')return;if($('#div_profile_gender').css('display')=='none'){$('#div_profile_gender').show();}
var gender=getValFromSelect("#profile_gender");$('#profile_full_gender').html(gender=='M'?'Male':'Female');}
function updateLocal(){if($('#profile_location_field').val()=='')return;if($('.profile_location_row').eq(0).css('display')=='none'){$('.profile_location_row').show();}
$('#profile_location').html($('#profile_location_field').val());}
function parseBirthday(){var y=getValFromSelect('#profile_birthday_1i');var m=getValFromSelect('#profile_birthday_2i');var d=getValFromSelect('#profile_birthday_3i');if(y==''&&m==''&&d=='')return'';if(y=='')y=2001;if(m=='')m=1;if(d=='')d=1;if(parseInt(d)<10)d='0'+d;var months=['','January','February','March','April','May','June','July','August','September','October','November','Demeber'];return months[m]+' '+d+', '+y;}
function getValFromSelect(id){return $(id).children().filter(function(index){return $(this).attr('selected')}).val();}
$(document).ready(function(){updateLocal();updateBirthday();$('#user_name_field').change(function(){$('#user_name').html($(this).val());});$('#profile_location_field').change(function(){updateLocal();});$('#profile_gender').change(function(){updateGender()});$('#profile_birthday_1i').change(function(){updateBirthday();});$('#profile_birthday_2i').change(function(){updateBirthday();});$('#profile_birthday_3i').change(function(){updateBirthday();});});(function($){$.jGrowl=function(m,o){if($("#jGrowl").size()==0){$("<div id=\"jGrowl\"></div>").addClass($.jGrowl.defaults.position).appendTo("body");}
$("#jGrowl").jGrowl(m,o);};$.fn.jGrowl=function(m,o){if($.isFunction(this.each)){var _6=arguments;return this.each(function(){var _7=this;if($(this).data("jGrowl.instance")==undefined){$(this).data("jGrowl.instance",new $.fn.jGrowl());$(this).data("jGrowl.instance").startup(this);}
if($.isFunction($(this).data("jGrowl.instance")[m])){$(this).data("jGrowl.instance")[m].apply($(this).data("jGrowl.instance"),$.makeArray(_6).slice(1));}else{$(this).data("jGrowl.instance").create(m,o);}});}};$.extend($.fn.jGrowl.prototype,{defaults:{pool:0,header:"",group:"",sticky:false,position:"top-right",glue:"after",theme:"default",corners:"10px",check:250,life:3000,speed:"normal",easing:"swing",closer:true,closeTemplate:"&times;",closerTemplate:"<div>[ close all ]</div>",log:function(e,m,o){},beforeOpen:function(e,m,o){},open:function(e,m,o){},beforeClose:function(e,m,o){},close:function(e,m,o){},animateOpen:{opacity:"show"},animateClose:{opacity:"hide"}},notifications:[],element:null,interval:null,create:function(_17,o){var o=$.extend({},this.defaults,o);this.notifications[this.notifications.length]={message:_17,options:o};o.log.apply(this.element,[this.element,_17,o]);},render:function(_19){var _1a=this;var _1b=_19.message;var o=_19.options;var _19=$("<div class=\"jGrowl-notification"+((o.group!=undefined&&o.group!="")?" "+o.group:"")+"\"><div class=\"close\">"+o.closeTemplate+"</div><div class=\"notification-header\">"+o.header+"</div><div class=\"notification-message\">"+_1b+"</div></div>").data("jGrowl",o).addClass(o.theme).children("div.close").bind("click.jGrowl",function(){$(this).parent().trigger("jGrowl.close");}).parent();(o.glue=="after")?$("div.jGrowl-notification:last",this.element).after(_19):$("div.jGrowl-notification:first",this.element).before(_19);$(_19).bind("mouseover.jGrowl",function(){$(this).data("jGrowl").pause=true;}).bind("mouseout.jGrowl",function(){$(this).data("jGrowl").pause=false;}).bind("jGrowl.beforeOpen",function(){o.beforeOpen.apply(_1a.element,[_1a.element,_1b,o]);}).bind("jGrowl.open",function(){o.open.apply(_1a.element,[_1a.element,_1b,o]);}).bind("jGrowl.beforeClose",function(){o.beforeClose.apply(_1a.element,[_1a.element,_1b,o]);}).bind("jGrowl.close",function(){$(this).trigger("jGrowl.beforeClose").animate(o.animateClose,o.speed,o.easing,function(){$(this).remove();o.close.apply(_1a.element,[_1a.element,_1b,o]);});}).trigger("jGrowl.beforeOpen").animate(o.animateOpen,o.speed,o.easing,function(){$(this).data("jGrowl").created=new Date();}).trigger("jGrowl.open");if($.fn.corner!=undefined){$(_19).corner(o.corners);}
if($("div.jGrowl-notification:parent",this.element).size()>1&&$("div.jGrowl-closer",this.element).size()==0&&this.defaults.closer!=false){$(this.defaults.closerTemplate).addClass("jGrowl-closer").addClass(this.defaults.theme).appendTo(this.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){$(this).siblings().children("div.close").trigger("click.jGrowl");if($.isFunction(_1a.defaults.closer)){_1a.defaults.closer.apply($(this).parent()[0],[$(this).parent()[0]]);}});}},update:function(){$(this.element).find("div.jGrowl-notification:parent").each(function(){if($(this).data("jGrowl")!=undefined&&$(this).data("jGrowl").created!=undefined&&($(this).data("jGrowl").created.getTime()+$(this).data("jGrowl").life)<(new Date()).getTime()&&$(this).data("jGrowl").sticky!=true&&($(this).data("jGrowl").pause==undefined||$(this).data("jGrowl").pause!=true)){$(this).trigger("jGrowl.close");}});if(this.notifications.length>0&&(this.defaults.pool==0||$(this.element).find("div.jGrowl-notification:parent").size()<this.defaults.pool)){this.render(this.notifications.shift());}
if($(this.element).find("div.jGrowl-notification:parent").size()<2){$(this.element).find("div.jGrowl-closer").animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){$(this).remove();});}},startup:function(e){this.element=$(e).addClass("jGrowl").append("<div class=\"jGrowl-notification\"></div>");this.interval=setInterval(function(){jQuery(e).data("jGrowl.instance").update();},this.defaults.check);if($.browser.msie&&parseInt($.browser.version)<7&&!window["XMLHttpRequest"]){$(this.element).addClass("ie6");}},shutdown:function(){$(this.element).removeClass("jGrowl").find("div.jGrowl-notification").remove();clearInterval(this.interval);}});$.jGrowl.defaults=$.fn.jGrowl.prototype.defaults;})(jQuery);